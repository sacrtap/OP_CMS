# Story 6.3: 导出模板管理

**Status:** ready-for-dev  
**Epic:** Epic 6 - 数据导入导出  
**Story Points:** 3  
**Priority:** Medium  

---

## User Story

As a 运营人员,  
I want 可以保存和管理常用的导出模板,  
So that 快速导出特定格式的数据。

---

## Acceptance Criteria

### AC 1: 创建导出模板
- **Given** 运营人员配置好导出字段和格式  
- **When** 点击"保存为模板"  
- **Then** 系统保存导出模板  
- **And** 支持命名和描述模板

### AC 2: 管理导出模板
- **Given** 运营人员进入模板管理页面  
- **When** 查看导出模板列表  
- **Then** 显示所有模板（名称、描述、创建时间）  
- **And** 支持编辑和删除模板

### AC 3: 使用模板导出
- **Given** 运营人员需要导出数据  
- **When** 选择已保存的导出模板  
- **Then** 系统自动应用模板的字段配置  
- **And** 支持临时调整字段

### AC 4: 共享模板
- **Given** 系统管理员管理模板  
- **When** 设置模板为共享  
- **Then** 所有用户可以使用该模板  
- **And** 支持按角色分配模板权限

---

## Tasks / Subtasks

- [ ] Task 1: 实现模板管理 API (AC: 1, 2)
  - [ ] Subtask 1.1: POST /api/v1/export-templates - 创建模板
  - [ ] Subtask 1.2: GET /api/v1/export-templates - 获取模板列表
  - [ ] Subtask 1.3: PUT /api/v1/export-templates/:id - 更新模板
  - [ ] Subtask 1.4: DELETE /api/v1/export-templates/:id - 删除模板

- [ ] Task 2: 实现模板使用 API (AC: 3, 4)
  - [ ] Subtask 2.1: GET /api/v1/export-templates/:id/apply - 应用模板
  - [ ] Subtask 2.2: 实现模板权限控制
  - [ ] Subtask 2.3: 支持模板共享

- [ ] Task 3: 实现前端模板管理界面 (AC: 1, 2, 3)
  - [ ] Subtask 3.1: ExportTemplates.vue - 模板管理主界面
  - [ ] Subtask 3.2: TemplateForm.vue - 模板表单组件
  - [ ] Subtask 3.3: 路由配置

- [ ] Task 4: 编写单元测试 (AC: 1, 2)
  - [ ] Subtask 4.1: 测试模板管理 API
  - [ ] Subtask 4.2: 测试模板应用 API
  - [ ] Subtask 4.3: 测试权限控制

---

## Technical Implementation Notes

### Backend Implementation

**Export Template Model:**
```python
class ExportTemplate(Base):
    id, name, description
    user_id, is_shared
    resource_type  # customer, settlement, payment
    fields: JSON  # ['company_name', 'contact_name', ...]
    format: String  # excel, csv
    filters: JSON  # optional default filters
    created_at, updated_at
```

**Template API:**
```python
POST /api/v1/export-templates
GET /api/v1/export-templates
PUT /api/v1/export-templates/:id
DELETE /api/v1/export-templates/:id
POST /api/v1/export-templates/:id/apply
```

---

## Dependencies

- ✅ Story 6.2: 导入导出增强 (已完成 - 导出基础)

---

## Definition of Done

- [ ] All 4 ACs implemented and tested
- [ ] Template management API working
- [ ] Template application working
- [ ] Frontend has template management UI
- [ ] Unit tests pass (>90% coverage)

---

## Change Log

- {{date}}: Story created
