# Story 7.2: 系统运行状态监控

**Status:** ready-for-dev  
**Epic:** Epic 7 - 系统集成与自动化  
**Story Points:** 5  
**Priority:** High  

---

## User Story

As a 系统管理员,  
I want 可以查看系统运行状态和日志,  
So that 及时发现和解决系统问题。

---

## Acceptance Criteria

### AC 1: 进入系统监控页面
- **Given** 系统管理员登录系统并进入系统监控  
- **When** 页面加载完成  
- **Then** 显示系统运行状态（CPU、内存、磁盘使用情况）  
- **And** 显示服务状态（数据库、Redis、应用服务）

### AC 2: 查看系统资源使用情况
- **Given** 系统管理员查看系统监控  
- **When** 查看资源使用情况  
- **Then** 显示 CPU 使用率、内存使用率、磁盘使用率  
- **And** 显示历史趋势图表

### AC 3: 查看系统日志
- **Given** 系统管理员需要查看系统日志  
- **When** 进入日志查看页面  
- **Then** 显示系统日志列表  
- **And** 支持按级别（INFO/WARNING/ERROR）和时间筛选

### AC 4: 查看错误信息
- **Given** 系统发生错误或异常  
- **When** 系统管理员查看错误信息  
- **Then** 显示错误详情（时间、类型、堆栈信息）  
- **And** 支持导出错误报告

---

## Tasks / Subtasks

- [ ] Task 1: 实现系统监控 API (AC: 1, 2)
  - [ ] Subtask 1.1: GET /api/v1/system/status - 获取系统状态
  - [ ] Subtask 1.2: GET /api/v1/system/resources - 获取资源使用情况
  - [ ] Subtask 1.3: GET /api/v1/system/services - 获取服务状态

- [ ] Task 2: 实现日志管理 API (AC: 3, 4)
  - [ ] Subtask 2.1: GET /api/v1/system/logs - 获取系统日志
  - [ ] Subtask 2.2: GET /api/v1/system/errors - 获取错误信息
  - [ ] Subtask 2.3: POST /api/v1/system/logs/export - 导出日志

- [ ] Task 3: 实现前端监控界面 (AC: 1, 2, 3, 4)
  - [ ] Subtask 3.1: SystemMonitor.vue - 系统监控主界面
  - [ ] Subtask 3.2: ResourceCharts.vue - 资源图表组件
  - [ ] Subtask 3.3: LogViewer.vue - 日志查看组件
  - [ ] Subtask 3.4: 路由配置 (/admin/system-monitor)

- [ ] Task 4: 编写单元测试 (AC: 1, 3)
  - [ ] Subtask 4.1: 测试系统监控 API
  - [ ] Subtask 4.2: 测试日志管理 API
  - [ ] Subtask 4.3: 测试前端组件

---

## Technical Implementation Notes

### Backend Implementation

**System Status API:**
```python
GET /api/v1/system/status
{
  "cpu_usage": 45.5,
  "memory_usage": 67.8,
  "disk_usage": 52.3,
  "services": {
    "database": "running",
    "redis": "running",
    "application": "running"
  }
}
```

**Log Management:**
```python
GET /api/v1/system/logs?level=ERROR&from=2026-03-20&limit=100
POST /api/v1/system/logs/export
```

### Frontend Components

**New Components:**
- `SystemMonitor.vue` - Dashboard with gauges and status
- `ResourceCharts.vue` - Charts for CPU, memory, disk
- `LogViewer.vue` - Log table with filtering

---

## Dependencies

- ✅ Story 5.1: 用户账户管理 (已完成 - 权限基础)
- ✅ Story 5.2: 角色分配与权限控制 (已完成 - 管理员权限)

---

## Definition of Done

- [ ] All 4 ACs implemented and tested
- [ ] System monitoring API working
- [ ] Log management API working
- [ ] Frontend has monitoring UI
- [ ] Unit tests pass (>90% coverage)

---

## Change Log

- {{date}}: Story created from epics.md
