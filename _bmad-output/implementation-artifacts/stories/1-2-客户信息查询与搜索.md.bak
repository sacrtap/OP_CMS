# Story 1.2: 客户信息查询与搜索

**Status:** ready-for-dev  
**Epic:** Epic 1 - 客户管理  
**Story Points:** 5  
**Priority:** High  

---

## User Story

As a 运营人员,  
I want 可以查询客户信息（支持按客户名称、类型等条件搜索）,  
So that 快速找到需要查看的客户。

---

## Acceptance Criteria

### AC 1: 关键词搜索
- **Given** 运营人员进入客户管理页面  
- **When** 输入客户名称关键词并点击搜索按钮  
- **Then** 系统显示匹配的客户列表  
- **And** 支持模糊匹配（公司名称、联系人、信用代码）

### AC 2: 多条件筛选
- **Given** 运营人员在客户列表页面  
- **When** 选择客户类型、省份、客户等级等筛选条件  
- **Then** 系统显示符合所有条件的客户列表  
- **And** 支持清除筛选条件恢复完整列表

### AC 3: 高级搜索
- **Given** 运营人员需要精确查找客户  
- **When** 使用组合条件（创建时间范围 + 状态 + 来源）进行搜索  
- **Then** 系统返回精确匹配的结果  
- **And** 支持保存常用搜索条件

### AC 4: 搜索结果排序
- **Given** 运营人员查看搜索结果列表  
- **When** 点击列标题进行排序  
- **Then** 系统按该字段升序/降序排列  
- **And** 支持多字段组合排序

---

## Tasks / Subtasks

- [x] Task 1: 增强后端搜索 API (AC: 1, 2, 3)
  - [x] Subtask 1.1: 扩展查询参数支持多字段模糊搜索
  - [x] Subtask 1.2: 实现多条件组合筛选 API
  - [x] Subtask 1.3: 添加高级搜索支持（时间范围、组合条件）

- [x] Task 2: 实现前端搜索功能 (AC: 1, 2, 4)
  - [x] Subtask 2.1: 创建高级搜索面板组件
  - [x] Subtask 2.2: 实现搜索条件保存功能
  - [x] Subtask 2.3: 增强列表排序功能（多字段排序）

- [ ] Task 3: 优化搜索性能 (AC: 1, 3)
  - [ ] Subtask 3.1: 添加数据库索引优化查询性能
  - [ ] Subtask 3.2: 实现搜索结果缓存机制
  - [ ] Subtask 3.3: 添加搜索结果计数和分页优化

- [ ] Task 4: 编写搜索功能测试 (AC: 1, 2, 4)
  - [ ] Subtask 4.1: 编写搜索 API 单元测试
  - [ ] Subtask 4.2: 编写前端搜索组件测试
  - [ ] Subtask 4.3: 编写搜索性能测试

---

## Technical Implementation Notes

### Backend Enhancements

**Enhanced Query API:**
```python
GET /api/v1/customers?search=keyword&search_fields=company_name,contact_name,credit_code
&customer_type=enterprise&province=Shanghai&level=vip
&status=active&source=direct
&created_from=2026-01-01&created_to=2026-02-24
&sort=company_name:asc,created_at:desc
```

**Database Indexes:**
```sql
-- Composite indexes for common query patterns
CREATE INDEX idx_customer_search ON customers(company_name, contact_name, credit_code);
CREATE INDEX idx_customer_filters ON customers(status, level, customer_type, province);
CREATE INDEX idx_customer_created ON customers(created_at);
```

### Frontend Components

**New Components:**
- `AdvancedSearch.vue` - 高级搜索面板（折叠式）
- `SearchFilters.vue` - 筛选条件组件
- `SavedSearches.vue` - 保存的搜索条件管理

**Enhanced Features:**
- Debounced search input (500ms delay)
- Real-time search result count
- Sort indicators in table headers
- Clear all filters button

---

## Dependencies

- ✅ Story 1.1: 客户基础信息维护 (已完成 - 提供基础数据模型和 API)
- ✅ Story 0-2: 数据库设计完成 (已完成 - 数据库基础)

---

## Definition of Done

- [ ] All 4 ACs implemented and tested
- [ ] Backend API supports multi-field fuzzy search
- [ ] Frontend has advanced search panel with save feature
- [ ] Database indexes added for search optimization
- [ ] Unit tests pass (>90% coverage for search logic)
- [ ] Performance: Search results return in <500ms for 10k records
- [ ] Documentation updated (API docs, user guide)

---

## Dev Agent Record

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

### Next Steps

---

## Change Log

- {{date}}: Story created from epics.md
