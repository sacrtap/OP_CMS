# Story 4.1: 管理驾驶舱实时数据看板

**Status:** ready-for-dev  
**Epic:** Epic 4 - 数据分析与报表  
**Story Points:** 8  
**Priority:** High  

---

## User Story

As a 管理人员,  
I want 可以通过管理驾驶舱查看实时数据看板,  
So that 快速了解公司整体运营状况。

---

## Acceptance Criteria

### AC 1: 进入管理驾驶舱页面
- **Given** 管理人员登录系统并进入管理驾驶舱  
- **When** 页面加载完成  
- **Then** 显示实时数据看板（总收入、回款率、客户流失率等）  
- **And** 显示数据更新时间

### AC 2: 查看核心指标卡片
- **Given** 管理人员查看管理驾驶舱  
- **When** 页面显示核心指标  
- **Then** 显示总收入、总客户数、待回款金额、逾期金额等关键指标  
- **And** 支持环比/同比数据对比

### AC 3: 查看数据趋势图表
- **Given** 管理人员查看数据趋势  
- **When** 选择时间维度（日/周/月）  
- **Then** 系统显示收入趋势、回款趋势图表  
- **And** 支持切换图表类型（折线图/柱状图）

### AC 4: 查看客户分布统计
- **Given** 管理人员查看客户分析  
- **When** 进入客户分布模块  
- **Then** 显示客户行业分布、地域分布、等级分布  
- **And** 支持饼图和柱状图切换

---

## Tasks / Subtasks

- [ ] Task 1: 实现数据看板 API (AC: 1, 2)
  - [ ] Subtask 1.1: GET /api/v1/dashboard/metrics - 获取核心指标
  - [ ] Subtask 1.2: GET /api/v1/dashboard/trends - 获取趋势数据
  - [ ] Subtask 1.3: GET /api/v1/dashboard/customer-stats - 获取客户统计

- [ ] Task 2: 实现前端驾驶舱界面 (AC: 1, 2, 3, 4)
  - [ ] Subtask 2.1: Dashboard.vue - 管理驾驶舱主界面
  - [ ] Subtask 2.2: MetricsCards.vue - 核心指标卡片组件
  - [ ] Subtask 2.3: TrendChart.vue - 趋势图表组件
  - [ ] Subtask 2.4: CustomerDistribution.vue - 客户分布组件
  - [ ] Subtask 2.5: 路由配置 (/dashboard)

- [ ] Task 3: 实现图表可视化 (AC: 3, 4)
  - [ ] Subtask 3.1: 集成 ECharts 图表库
  - [ ] Subtask 3.2: 实现折线图/柱状图/饼图
  - [ ] Subtask 3.3: 实现图表交互（缩放、筛选）

- [ ] Task 4: 编写单元测试 (AC: 1, 3)
  - [ ] Subtask 4.1: 测试数据看板 API 端点
  - [ ] Subtask 4.2: 测试前端组件
  - [ ] Subtask 4.3: 测试图表渲染

---

## Technical Implementation Notes

### Backend Implementation

**Dashboard API:**
```python
GET /api/v1/dashboard/metrics
Response:
{
  "total_revenue": 1000000,
  "total_customers": 1320,
  "pending_payment": 200000,
  "overdue_payment": 50000,
  "collection_rate": 0.85,
  "customer_churn_rate": 0.05
}

GET /api/v1/dashboard/trends?dimension=month&range=6
Response:
{
  "revenue_trend": [...],
  "payment_trend": [...],
  "customer_growth": [...]
}
```

### Frontend Components

**New Components:**
- `Dashboard.vue` - Main dashboard layout
- `MetricsCards.vue` - KPI cards with comparison
- `TrendChart.vue` - Line/Bar charts
- `CustomerDistribution.vue` - Pie charts for customer stats

**Chart Library:**
- ECharts 5.x
- Vue-ECharts integration

---

## Dependencies

- ✅ Story 3.1: 自动化账单生成 (已完成 - 提供账单数据)
- ✅ Story 3.2: 账单审核工作流 (已完成 - 提供审核数据)
- ✅ Story 3.4: 收款核销功能 (已完成 - 提供付款数据)

---

## Definition of Done

- [ ] All 4 ACs implemented and tested
- [ ] Dashboard API endpoints working
- [ ] Frontend has complete dashboard UI
- [ ] ECharts integration complete
- [ ] Real-time data display
- [ ] Unit tests pass (>90% coverage)

---

## Dev Agent Record

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

### Next Steps

---

## Change Log

- {{date}}: Story created from epics.md
