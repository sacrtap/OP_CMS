# Story 7.1: 系统参数配置

**Status:** ready-for-dev  
**Epic:** Epic 7 - 系统集成与自动化  
**Story Points:** 5  
**Priority:** High  

---

## User Story

As a 系统管理员,  
I want 可以配置系统参数（结算周期、预警阈值等）,  
So that 根据业务需求调整系统行为。

---

## Acceptance Criteria

### AC 1: 进入系统配置页面
- **Given** 系统管理员登录系统并进入系统配置  
- **When** 页面加载完成  
- **Then** 显示所有可配置的系统参数  
- **And** 显示当前配置值

### AC 2: 配置结算周期
- **Given** 系统管理员需要修改结算周期  
- **When** 选择结算周期（月结/季结/年结）并保存  
- **Then** 系统验证参数的有效性  
- **And** 提示配置成功并应用到系统

### AC 3: 配置预警阈值
- **Given** 系统管理员需要修改预警阈值  
- **When** 配置逾期预警阈值（30 天/60 天/90 天）  
- **Then** 系统保存配置  
- **And** 在结算管理中使用新阈值

### AC 4: 配置其他系统参数
- **Given** 系统管理员需要配置其他参数  
- **When** 配置系统参数（导入限制、导出限制、分页大小等）  
- **Then** 系统验证并保存配置  
- **And** 参数立即生效

---

## Tasks / Subtasks

- [ ] Task 1: 实现系统参数数据模型 (AC: 1)
  - [ ] Subtask 1.1: 创建 SystemParameter 模型
  - [ ] Subtask 1.2: 创建数据库迁移脚本
  - [ ] Subtask 1.3: 初始化默认参数

- [ ] Task 2: 实现参数管理 API (AC: 2, 3, 4)
  - [ ] Subtask 2.1: GET /api/v1/system-parameters - 获取参数列表
  - [ ] Subtask 2.2: PUT /api/v1/system-parameters/:key - 更新参数
  - [ ] Subtask 2.3: GET /api/v1/system-parameters/:key - 获取单个参数

- [ ] Task 3: 实现前端参数配置界面 (AC: 1, 2, 3, 4)
  - [ ] Subtask 3.1: SystemParameters.vue - 参数配置主界面
  - [ ] Subtask 3.2: ParameterForm.vue - 参数表单组件
  - [ ] Subtask 3.3: 路由配置 (/admin/system-parameters)

- [ ] Task 4: 编写单元测试 (AC: 2, 4)
  - [ ] Subtask 4.1: 测试参数管理 API
  - [ ] Subtask 4.2: 测试参数验证
  - [ ] Subtask 4.3: 测试前端组件

---

## Technical Implementation Notes

### Backend Implementation

**System Parameter Model:**
```python
class SystemParameter(Base):
    key: String (unique)  # e.g., 'settlement_cycle', 'overdue_warning_days'
    value: String  # e.g., 'monthly', '30'
    value_type: String  # string, integer, boolean, json
    description: String
    category: String  # settlement, warning, import, export
    updated_at: DateTime
    updated_by: Integer (user_id)
```

**Parameter API:**
```python
GET /api/v1/system-parameters
PUT /api/v1/system-parameters/:key
GET /api/v1/system-parameters/:key
```

### Frontend Components

**New Components:**
- `SystemParameters.vue` - Parameter configuration page
- `ParameterForm.vue` - Parameter form with validation
- Parameter type selectors (dropdown, input, toggle)

---

## Dependencies

- ✅ Story 5.1: 用户账户管理 (已完成 - 用户模型)
- ✅ Story 5.2: 角色分配与权限控制 (已完成 - 权限基础)

---

## Definition of Done

- [ ] All 4 ACs implemented and tested
- [ ] System parameter model created
- [ ] Parameter management API working
- [ ] Frontend has parameter configuration UI
- [ ] Unit tests pass (>90% coverage)

---

## Change Log

- {{date}}: Story created from epics.md
