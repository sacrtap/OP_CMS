# Story 6.2: 导入导出增强

**Status:** ready-for-dev  
**Epic:** Epic 6 - 数据导入导出  
**Story Points:** 5  
**Priority:** High  

---

## User Story

As a 运营人员,  
I want 可以导入和导出客户数据（支持 Excel/CSV 格式）,  
So that 方便数据迁移和备份。

---

## Acceptance Criteria

### AC 1: 导入客户数据
- **Given** 运营人员进入客户管理页面  
- **When** 点击"导入"按钮并上传 Excel/CSV 文件  
- **Then** 系统解析文件并显示预览  
- **And** 显示数据质量和重复检测结果

### AC 2: 选择导入模式
- **Given** 运营人员确认导入数据  
- **When** 选择导入模式（新增/更新/跳过重复）  
- **Then** 系统按照选择的模式执行导入  
- **And** 显示导入结果（成功/失败数量）

### AC 3: 导出客户数据
- **Given** 运营人员需要导出客户数据  
- **When** 选择导出条件（全部/筛选结果）和格式（Excel/CSV）  
- **Then** 系统生成导出文件并提供下载  
- **And** 包含选定的字段

### AC 4: 导出模板管理
- **Given** 运营人员需要自定义导出字段  
- **When** 配置导出模板  
- **Then** 系统保存导出模板  
- **And** 支持选择模板进行导出

---

## Tasks / Subtasks

- [ ] Task 1: 实现导入 API (AC: 1, 2)
  - [ ] Subtask 1.1: POST /api/v1/customers/import - 导入客户数据
  - [ ] Subtask 1.2: 支持 Excel/CSV 格式解析
  - [ ] Subtask 1.3: 实现导入模式（新增/更新/跳过）

- [ ] Task 2: 实现导出 API (AC: 3, 4)
  - [ ] Subtask 2.1: POST /api/v1/customers/export - 导出客户数据
  - [ ] Subtask 2.2: 支持 Excel/CSV 格式导出
  - [ ] Subtask 2.3: 实现导出模板管理

- [ ] Task 3: 实现前端导入导出界面 (AC: 1, 3, 4)
  - [ ] Subtask 3.1: ImportExport.vue - 导入导出主界面
  - [ ] Subtask 3.2: ImportPreview.vue - 导入预览组件
  - [ ] Subtask 3.3: ExportTemplate.vue - 导出模板组件

- [ ] Task 4: 编写单元测试 (AC: 1, 2)
  - [ ] Subtask 4.1: 测试导入 API
  - [ ] Subtask 4.2: 测试导出 API
  - [ ] Subtask 4.3: 测试导入模式

---

## Technical Implementation Notes

### Backend Implementation

**Import API:**
```python
POST /api/v1/customers/import
{
  "file": "base64_encoded_file",
  "import_mode": "skip_duplicates",  // skip_duplicates, update_duplicates, create_all
  "validate_only": false
}

Response:
{
  "success": true,
  "data": {
    "total_rows": 100,
    "imported": 95,
    "skipped": 5,
    "errors": [...]
  }
}
```

**Export API:**
```python
POST /api/v1/customers/export
{
  "format": "excel",  // excel, csv
  "filters": {...},
  "fields": ["company_name", "contact_name", ...],
  "template_id": 1  // optional
}

Response:
{
  "success": true,
  "data": {
    "file_content": "base64_encoded",
    "file_name": "customers_20260320.xlsx",
    "total_records": 1000
  }
}
```

---

## Dependencies

- ✅ Story 6.1: 数据质量验证与重复检测 (已完成 - 验证服务)
- ✅ Story 1.4: 客户数据 excel 批量导入 (已完成 - 导入基础)

---

## Definition of Done

- [ ] All 4 ACs implemented and tested
- [ ] Import API working with multiple modes
- [ ] Export API working with templates
- [ ] Frontend has import/export UI
- [ ] Unit tests pass (>90% coverage)

---

## Change Log

- {{date}}: Story created
