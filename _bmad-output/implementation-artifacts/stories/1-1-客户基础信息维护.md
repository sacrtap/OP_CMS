# Story 1.1: 客户基础信息维护

Status: done

<!-- Note: Validation is optional. Run validate-create-story for quality check before dev-story. -->

## Story

As a 运营人员,
I want 可以维护客户基础信息（公司名称、联系人、ERP 系统等）,
So that 统一管理 1320 条客户数据。

## Acceptance Criteria

1. **AC1: 新增客户**
   - Given 运营人员登录系统并进入客户管理页面
   - When 点击"新增客户"按钮并填写完整客户信息（18 个字段）
   - Then 系统验证必填字段并保存客户信息
   - And 返回成功提示并刷新客户列表

2. **AC2: 字段验证**
   - Given 运营人员填写客户信息
   - When 提交表单时
   - Then 系统验证必填字段（公司名称、联系人、联系方式）
   - And 验证字段格式（手机号、邮箱、统一社会信用代码等）
   - And 显示错误提示并阻止无效提交

3. **AC3: 客户列表展示**
   - Given 运营人员进入客户管理页面
   - When 页面加载完成
   - Then 系统显示客户列表（包含公司名称、联系人、联系方式、状态）
   - And 支持分页（每页 20 条）
   - And 显示总计数量

4. **AC4: 数据一致性**
   - Given 系统中已存在客户数据
   - When 新增客户时输入重复的公司名称或统一社会信用代码
   - Then 系统检测重复并提示
   - And 阻止重复数据的创建

## Tasks / Subtasks

- [x] Task 1: 实现客户数据模型和数据库表 (AC: 1, 2, 4)
  - [x] Subtask 1.1: 扩展 Customer 模型添加 18 个字段
  - [x] Subtask 1.2: 实现数据验证逻辑（Pydantic validators）
  - [x] Subtask 1.3: 创建数据库迁移脚本

- [x] Task 2: 实现后端 API 接口 (AC: 1, 2, 3, 4)
  - [x] Subtask 2.1: 实现客户列表查询 API（分页、过滤）
  - [x] Subtask 2.2: 实现新增客户 API（含数据验证）
  - [x] Subtask 2.3: 实现重复数据检测逻辑
  - [x] Subtask 2.4: 实现客户详情 API

- [x] Task 3: 实现前端客户管理界面 (AC: 1, 2, 3)
  - [x] Subtask 3.1: 创建客户列表组件（表格、分页、状态显示）
  - [x] Subtask 3.2: 创建新增/编辑客户表单组件（18 个字段、验证）
  - [x] Subtask 3.3: 实现前端表单验证逻辑
  - [x] Subtask 3.4: 实现错误提示和成功通知

- [x] Task 4: 编写单元测试和集成测试 (AC: 1, 2, 4)
  - [x] Subtask 4.1: 编写后端模型测试
  - [x] Subtask 4.2: 编写 API 接口测试
  - [x] Subtask 4.3: 编写前端组件测试

## Dev Notes

### 客户基础信息字段 (18 个)

**必填字段:**
- 公司名称 (company_name, VARCHAR(200), 唯一)
- 联系人 (contact_name, VARCHAR(100))
- 联系方式 (contact_phone, VARCHAR(20))

**选填字段:**
- 统一社会信用代码 (credit_code, VARCHAR(50), 唯一)
- 客户类型 (customer_type: enterprise/individual)
- 省份 (province)
- 城市 (city)
- 地址 (address, VARCHAR(500))
- 邮箱 (email, VARCHAR(100))
- 网址 (website, VARCHAR(200))
- 所属行业 (industry, VARCHAR(100))
- ERP 系统 (erp_system, VARCHAR(100))
- ERP 客户代码 (erp_customer_code, VARCHAR(50))
- 备注 (remarks, TEXT)
- 客户状态 (status: active/inactive/potential, default: active)
- 客户等级 (level: vip/standard/economy, default: standard)
- 来源渠道 (source: direct/referral/marketing, default: direct)

### 数据验证规则

1. **手机号验证**: 支持中国大陆手机号 (+86 前缀，11 位数字)
2. **邮箱验证**: 标准邮箱格式
3. **统一社会信用代码验证**: 18 位，符合 GB 32100-2015 标准
4. **唯一性验证**: 公司名称、统一社会信用代码不可重复
5. **必填字段验证**: 公司名称、联系人、联系方式必填

### 技术实现要点

1. **后端验证**: 使用 Pydantic v2 validators
2. **数据库约束**: UNIQUE INDEX on company_name, credit_code
3. **事务处理**: 新增操作使用数据库事务
4. **错误处理**: 详细的错误信息返回（区分重复、格式错误等）

### Project Structure Notes

**需要创建/修改的文件:**
- `backend/models/customer.py` - 客户数据模型 (扩展 Story 0-2 的 Customer 模型)
- `backend/api/customers.py` - 客户管理 API 端点
- `backend/schemas/customer.py` - Pydantic schemas (Create, Update, Response)
- `frontend/src/views/customer/List.vue` - 客户列表页面
- `frontend/src/views/customer/Create.vue` - 新增客户表单
- `frontend/src/components/customer/CustomerForm.vue` - 客户表单组件
- `frontend/src/api/customer.ts` - 客户 API 调用封装

**依赖关系:**
- 依赖 Story 0-2 的数据库基础模型
- 依赖 Story 0-3 的 API 适配器模式
- 依赖 Story 0-4 的 Docker 部署配置

### References

- [Source: _bmad-output/planning-artifacts/epics.md#Epic-1-客户信息管理](epics.md)
- [Source: _bmad-output/planning-artifacts/prd.md#FR1-客户管理](prd.md)
- [Source: backend/models/database_models.py#Customer](database_models.py)
- [Source: docs/PRD-v1.md#客户基础信息字段](PRD-v1.md)

## Dev Agent Record

### Agent Model Used

opencode-coding-planner

### Debug Log References

### Completion Notes List

### File List
