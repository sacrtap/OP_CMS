# Story 4.4: 多维度报表导出

**Status:** ready-for-dev  
**Epic:** Epic 4 - 数据分析与报表  
**Story Points:** 3  
**Priority:** High  

---

## User Story

As a 运营人员,  
I want 可以导出多维度分析报表 (PDF/Excel),  
So that 便于汇报和存档。

---

## Acceptance Criteria

### AC 1: 进入报表导出页面
- **Given** 运营人员进入报表管理页面  
- **When** 页面加载完成  
- **Then** 显示可用报表列表（客户分析报表、收入报表、回款报表）  
- **And** 显示报表说明和导出格式

### AC 2: 选择报表维度和格式
- **Given** 运营人员选择报表  
- **When** 配置报表参数（时间范围、客户范围、维度）  
- **Then** 系统支持选择导出格式（PDF/Excel）  
- **And** 显示预览

### AC 3: 导出报表文件
- **Given** 运营人员配置完成报表  
- **When** 点击"导出"按钮  
- **Then** 系统生成报表文件并提供下载  
- **And** 支持邮件发送报表

### AC 4: 报表模板管理
- **Given** 运营人员需要自定义报表  
- **When** 进入报表模板管理  
- **Then** 支持保存自定义报表模板  
- **And** 支持共享模板给其他用户

---

## Tasks / Subtasks

- [ ] Task 1: 实现报表导出 API (AC: 3)
  - [ ] Subtask 1.1: POST /api/v1/reports/export - 导出报表
  - [ ] Subtask 1.2: 实现 Excel 导出功能
  - [ ] Subtask 1.3: 实现 PDF 导出功能

- [ ] Task 2: 实现前端报表界面 (AC: 1, 2, 4)
  - [ ] Subtask 2.1: Reports.vue - 报表管理主界面
  - [ ] Subtask 2.2: ReportExport.vue - 报表导出组件
  - [ ] Subtask 2.3: 路由配置 (/reports)

- [ ] Task 3: 编写单元测试 (AC: 3)
  - [ ] Subtask 3.1: 测试报表导出 API
  - [ ] Subtask 3.2: 测试 Excel 导出
  - [ ] Subtask 3.3: 测试 PDF 导出

---

## Technical Implementation Notes

### Backend Implementation

**Export API:**
```python
POST /api/v1/reports/export
{
  "report_type": "customer_analysis",
  "format": "excel",  // excel or pdf
  "filters": {
    "date_from": "2026-01-01",
    "date_to": "2026-02-28",
    "customer_ids": [1, 2, 3]
  }
}

Response:
{
  "success": true,
  "data": {
    "file_url": "/downloads/report_20260228.xlsx",
    "file_name": "customer_analysis_20260228.xlsx",
    "file_size": 102400
  }
}
```

**Libraries:**
- Excel: openpyxl, xlsxwriter
- PDF: reportlab or WeasyPrint

---

## Dependencies

- ✅ Story 3.1: 自动化账单生成 (已完成 - 提供数据)
- ✅ Story 4.1: 管理驾驶舱 (已完成 - 提供数据基础)
- ✅ Story 4.2: 客户分层 (已完成 - 提供分析数据)
- ✅ Story 4.3: 用量趋势 (已完成 - 提供趋势数据)

---

## Definition of Done

- [ ] All 4 ACs implemented and tested
- [ ] Report export API working
- [ ] Excel export implemented
- [ ] PDF export implemented
- [ ] Frontend report management UI
- [ ] Unit tests pass (>90% coverage)

---

## Dev Agent Record

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

### Next Steps

---

## Change Log

- {{date}}: Story created from epics.md
