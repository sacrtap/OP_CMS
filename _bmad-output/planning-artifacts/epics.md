---
stepsCompleted: ['step-01-validate-prerequisites', 'step-02-design-epics', 'step-03-create-stories', 'step-04-final-validation']
inputDocuments: [
  "/Users/sacrtap/Documents/trae_projects/OP_CMS/_bmad-output/planning-artifacts/prd.md",
  "/Users/sacrtap/Documents/trae_projects/OP_CMS/_bmad-output/planning-artifacts/architecture-design-v1.md"
]
---

# OP_CMS - Epic Breakdown

## Overview

This document provides the complete epic and story breakdown for OP_CMS, decomposing the requirements from the PRD, UX Design if it exists, and Architecture requirements into implementable stories.

## Requirements Inventory

### Functional Requirements

FR1. 客户管理
- [运营人员] 可以维护客户基础信息（公司名称、联系人、ERP系统等）
- [运营人员] 可以查询客户信息（支持按客户名称、类型等条件搜索）
- [运营人员] 可以编辑客户信息（修改联系人、联系方式等）
- [运营人员] 可以删除不再合作的客户信息
- [销售负责人] 可以查看负责客户的详细信息
- [销售负责人] 可以查看客户用量趋势和历史数据
- [管理人员] 可以查看所有客户的汇总信息和分层数据

FR2. 定价配置
- [运营人员] 可以配置单层定价模式（固定价格）
- [运营人员] 可以配置多层定价模式（分段价格）
- [运营人员] 可以配置阶梯定价模式（累进价格）
- [运营人员] 可以为不同设备系列（X/N/L）配置价格
- [运营人员] 可以查看价格配置的变更历史记录
- [运营人员] 可以回滚错误的价格配置变更
- [运营人员] 可以为每个客户设置专属的定价模式和价格

FR3. 结算管理
- [运营人员] 可以自动生成客户账单（根据预配置的价格模式）
- [运营人员] 可以手动录入特殊场景的结算结果
- [运营人员] 可以结算和校验账单的准确性
- [运营人员] 可以发送账单给客户
- [运营人员] 可以记录客户的付款信息（收款核销）
- [销售负责人] 可以查看负责客户的账单信息和付款状态
- [销售负责人] 可以接收客户逾期付款的自动提醒
- [管理人员] 可以查看所有客户的账单执行情况

FR4. 数据分析与报表
- [运营人员] 可以查看结算过程中的异常数据标记
- [运营人员] 可以生成基础结算报表（月度、季度）
- [销售负责人] 可以导出负责客户的数据报表
- [销售负责人] 可以查看客户用量趋势分析图表
- [管理人员] 可以通过管理驾驶舱查看实时数据看板
- [管理人员] 可以查看客户分层和风险预警信息
- [管理人员] 可以查看关键指标分析（总收入、回款率、客户流失率等）
- [所有用户] 可以配置关键指标的阈值预警规则
- [所有用户] 可以订阅报表并定期接收

FR5. 用户权限管理
- [系统管理员] 可以创建和管理用户账户
- [系统管理员] 可以为用户分配角色（运营/销售/管理）
- [系统管理员] 可以配置用户的数据权限范围（按区域、客户类型等）
- [系统管理员] 可以设置精细的操作权限控制
- [所有用户] 可以根据角色访问对应的数据和功能
- [系统管理员] 可以查看用户操作审计日志

FR6. 数据导入导出
- [运营人员] 可以批量导入客户基础信息（Excel格式）
- [运营人员] 可以导出客户信息和账单数据
- [所有用户] 可以导出报表为多种格式（PDF、Excel、CSV、图片）
- [运营人员] 可以导入结算相关的辅助数据
- [系统] 可以对导入的数据进行质量验证（字段完整性、格式检查）
- [系统] 可以检测和标记重复数据

FR7. 系统管理
- [系统管理员] 可以配置系统参数（结算周期、预警阈值等）
- [系统管理员] 可以查看系统运行状态和日志
- [系统管理员] 可以管理数据备份和恢复
- [所有用户] 可以使用移动端访问系统
- [所有用户] 可以接收系统通知和提醒
- [系统] 可以自动执行每日增量备份和每周全量备份
- [系统] 可以对敏感数据进行加密传输和存储

### NonFunctional Requirements

NFR1. 性能
- 核心操作响应时间：客户查询、账单生成等核心操作响应时间 < 2秒
- 数据导入效率：1320条客户基础信息批量导入时间 < 10分钟
- 账单生成效率：系统生成1320条客户账单时间 < 30分钟
- 并发用户支持：支持至少20个并发用户同时使用系统
- 报表生成速度：复杂报表（含图表）生成时间 < 15秒

NFR2. 安全性
- 数据加密：敏感数据（价格配置、客户信息）存储时采用 AES-256 加密，传输时使用 HTTPS 加密
- 权限管理：实现三级权限控制（运营/销售/管理），确保数据隔离和操作权限精细管控
- 操作审计：所有敏感操作（如价格配置变更、客户信息修改）需记录详细审计日志，包括操作人、时间、内容
- 数据备份：每日增量备份 + 每周全量备份，数据备份完整性达100%
- 登录安全：支持密码强度校验、登录失败次数限制、会话超时控制（默认30分钟）

NFR3. 可靠性
- 系统可用性：≥99.5%（每周计划维护时间 ≤4小时）
- 数据一致性：客户信息、价格配置等核心数据一致性达100%
- 故障恢复：系统故障后恢复时间 ≤1小时
- 数据准确性：结算计算准确性 ≥99.5%（系统计算结果与人工校验结果差异率 <0.5%）
- 错误处理：系统对异常数据有完善的检测和处理机制，关键操作有失败重试功能

NFR4. 可扩展性
- 用户规模扩展：支持用户数量从当前20人增长到500人
- 数据规模扩展：支持客户数量从当前1320条增长到5000条以上
- 功能扩展：系统架构支持未来添加新功能（如自定义公式编辑、智能对账等）
- 硬件扩展：支持服务器硬件升级和负载均衡配置

NFR5. 可访问性
- 界面响应式：系统界面支持不同屏幕尺寸（PC端、平板、手机）
- 移动端支持：支持移动端访问（iOS/Android），移动端核心功能可用率 ≥90%
- 操作简洁性：关键操作流程≤3步完成，用户学习成本 ≤2小时
- 辅助功能：支持键盘导航、屏幕阅读器等辅助技术
- 语言支持：系统界面支持中文简体，未来可扩展多语言

NFR6. 技术架构
- 前端架构：Vue 3 + TypeScript + Pinia 状态管理 + Vue Router 路由
- 后端架构：Python 3.9+ Sanic 框架 + MySQL 8.0+ 数据库
- 缓存机制：Redis 缓存（客户基础信息、价格配置、常用报表）
- 异步任务：Celery 消息队列（账单生成、报表导出、数据备份）
- 部署架构：Docker 容器化部署 + Docker Compose 容器编排
- 数据存储：客户信息、价格配置、结算记录等核心数据使用 MySQL 8.0+ 存储
- 文件存储：导入/导出的 Excel/PDF 文件使用云存储（如 AWS S3 或阿里云 OSS）

NFR7. 集成性
- ERP系统集成：支持与企业现有ERP系统的数据同步（客户信息、订单数据）
- 数据格式支持：支持导入/导出Excel、CSV、PDF等格式文件
- API接口：提供标准RESTful API接口，支持与其他系统的数据交换
- 第三方服务集成：支持与邮件服务（发送报表通知）、短信服务（发送逾期提醒）集成

NFR8. 用户体验
- 界面设计：采用简洁现代的UI设计，符合企业内部系统使用习惯
- 操作反馈：所有操作有明确的成功/失败反馈，加载状态有进度提示
- 帮助文档：提供详细的用户手册和在线帮助，常见问题覆盖率 ≥90%
- 错误提示：错误信息清晰明确，提供解决建议
- 自定义配置：支持用户自定义界面主题、报表格式等个性化设置

### Additional Requirements

- 项目初始化：使用所选启动模板创建项目结构
- 数据库设计完成：核心模型实现
- 外部 API 对接：获取用量数据 API 文档，实现适配器模式
- 数据清洗启动：对 1320 条 Excel 数据进行预处理
- 项目立项：确定团队成员和时间表
- 前端组件架构设计
- 部署架构方案（Docker + Docker Compose）
- 监控和日志方案

### FR Coverage Map

| FR编号 | 功能模块 | 覆盖需求 |
|--------|----------|----------|
| FR1 | 客户管理 | 客户信息维护、查询、导入导出 |
| FR2 | 定价配置 | 单层/多层/阶梯定价模式配置 |
| FR3 | 结算管理 | 账单生成、收款核销、逾期提醒 |
| FR4 | 数据分析与报表 | 实时数据看板、客户分层、风险预警 |
| FR5 | 用户权限管理 | 三级权限控制、操作审计 |
| FR6 | 数据导入导出 | Excel导入导出、数据质量验证 |
| FR7 | 系统管理 | 系统参数配置、数据备份、移动端访问 |

## Epic List

0. 项目架构基础
1. 客户信息管理
2. 定价配置管理
3. 结算管理
4. 数据分析与报表
5. 用户权限管理
6. 数据导入导出
7. 系统管理

## Epic 0: 项目架构基础

**目标：** 实现项目初始化、数据库设计、外部API对接和部署架构配置，为系统开发提供基础支持。

### Story 0.1: 项目初始化
As a 系统管理员,
I want 可以使用所选启动模板创建项目结构,
So that 快速搭建Vue 3 + Python Sanic的开发环境。

**Acceptance Criteria:**
- Given 系统管理员在开发环境中
- When 执行项目初始化命令
- Then 系统创建完整的前端和后端项目结构
- And 包含基础的配置文件和依赖声明

### Story 0.2: 数据库设计完成
As a 系统管理员,
I want 可以实现核心数据模型和MySQL 8.0+数据库结构,
So that 为系统提供数据存储支持。

**Acceptance Criteria:**
- Given 系统管理员执行数据库迁移
- When 运行数据库初始化脚本
- Then 系统创建所有核心业务表和关系
- And 包含客户信息、价格配置、结算记录等表结构

### Story 0.3: 外部API对接
As a 系统管理员,
I want 可以实现外部API适配器模式,
So that 支持调用三方系统API获取用量数据。

**Acceptance Criteria:**
- Given 系统管理员配置外部API参数
- When 调用用量数据采集接口
- Then 系统使用适配器模式调用对应数据源
- And 统一处理API响应和错误重试

### Story 0.4: 部署架构方案
As a 系统管理员,
I want 可以配置Docker容器化部署和Docker Compose编排,
So that 简化开发和生产环境的部署过程。

**Acceptance Criteria:**
- Given 系统管理员在服务器上执行部署命令
- When 运行Docker Compose配置
- Then 系统启动所有服务容器
- And 提供健康检查和日志查看功能

## Epic 1: 客户信息管理

**目标：** 实现客户信息的全生命周期管理，包括客户档案维护、查询、Excel批量导入和数据清洗功能。

### Story 1.1: 客户基础信息维护
As a 运营人员,
I want 可以维护客户基础信息（公司名称、联系人、ERP系统等）,
So that 统一管理1320条客户数据。

**Acceptance Criteria:**
- Given 运营人员登录系统并进入客户管理页面
- When 点击"新增客户"按钮并填写完整客户信息（18个字段）
- Then 系统验证必填字段并保存客户信息
- And 返回成功提示并刷新客户列表

### Story 1.2: 客户信息查询与搜索
As a 运营人员,
I want 可以查询客户信息（支持按客户名称、类型等条件搜索）,
So that 快速找到需要查看的客户。

**Acceptance Criteria:**
- Given 运营人员进入客户管理页面
- When 输入客户名称关键词并点击搜索按钮
- Then 系统显示匹配的客户列表
- And 支持按客户类型、区域等条件进行筛选

### Story 1.3: 客户信息编辑与删除
As a 运营人员,
I want 可以编辑客户信息（修改联系人、联系方式等）和删除不再合作的客户,
So that 保持客户数据的准确性。

**Acceptance Criteria:**
- Given 运营人员在客户列表中找到需要编辑的客户
- When 点击"编辑"按钮修改客户信息
- Then 系统验证修改内容并保存
- And 对于删除操作，系统会提示确认并执行软删除

### Story 1.4: 客户数据Excel批量导入
As a 运营人员,
I want 可以批量导入客户基础信息（Excel格式）,
So that 快速完成1320条客户数据的初始化。

**Acceptance Criteria:**
- Given 运营人员进入数据导入页面
- When 上传包含客户信息的Excel文件（18个字段）
- Then 系统解析Excel数据并进行质量验证
- And 显示导入报告（成功/失败明细）并将数据批量入库

### Story 1.5: 客户信息查看权限
As a 销售负责人,
I want 可以查看负责客户的详细信息和用量趋势,
So that 掌握客户的基本情况和业务数据。

**Acceptance Criteria:**
- Given 销售负责人登录系统
- When 进入客户管理页面
- Then 系统只显示该销售负责人负责的客户列表
- And 支持查看客户详细信息和历史用量数据

## Epic 2: 定价配置管理

**目标：** 实现三种定价模式（单层/多层/阶梯定价）的配置管理，支持价格版本控制和回滚功能。

### Story 2.1: 单层定价模式配置
As a 运营人员,
I want 可以配置单层定价模式（固定价格）,
So that 为客户设置简单的定价规则。

**Acceptance Criteria:**
- Given 运营人员进入定价配置页面
- When 选择"单层定价"模式并设置单价
- Then 系统保存定价配置并关联到客户
- And 支持为不同设备系列（X/N/L）设置不同价格

### Story 2.2: 多层定价模式配置
As a 运营人员,
I want 可以配置多层定价模式（分段价格）,
So that 为客户设置复杂的阶梯定价规则。

**Acceptance Criteria:**
- Given 运营人员进入定价配置页面
- When 选择"多层定价"模式并设置多个价格阶梯
- Then 系统保存定价配置并关联到客户
- And 支持查看和编辑已配置的价格阶梯

### Story 2.3: 阶梯定价模式配置
As a 运营人员,
I want 可以配置阶梯定价模式（累进价格）,
So that 为客户设置累进式的定价规则。

**Acceptance Criteria:**
- Given 运营人员进入定价配置页面
- When 选择"阶梯定价"模式并设置累进价格
- Then 系统保存定价配置并关联到客户
- And 支持查看和编辑已配置的阶梯价格

### Story 2.4: 价格配置版本控制
As a 运营人员,
I want 可以查看价格配置的变更历史记录并回滚错误的变更,
So that 确保价格配置的准确性和可追溯性。

**Acceptance Criteria:**
- Given 运营人员进入定价配置页面
- When 点击"查看历史"按钮
- Then 系统显示价格配置的变更历史记录
- And 支持回滚到指定版本的价格配置

## Epic 3: 结算管理

**目标：** 实现自动化账单生成、收款核销和逾期提醒功能，确保结算过程的准确性和效率。

### Story 3.1: 自动化账单生成
As a 运营人员,
I want 可以自动生成客户账单（根据预配置的价格模式）,
So that 替代手工计算，提高结算效率。

**Acceptance Criteria:**
- Given 运营人员进入结算管理页面
- When 选择结算周期并点击"生成账单"按钮
- Then 系统自动计算所有客户的账单金额
- And 显示账单生成进度并生成详细账单记录

### Story 3.2: 手工录入特殊场景结算结果
As a 运营人员,
I want 可以手动录入特殊场景的结算结果,
So that 处理5%的边缘场景。

**Acceptance Criteria:**
- Given 运营人员进入结算管理页面
- When 选择需要手工录入的客户并点击"手工录入"按钮
- Then 系统显示手工录入界面并保存录入结果
- And 支持对录入结果进行审核和修改

### Story 3.3: 账单校验与发送
As a 运营人员,
I want 可以结算和校验账单的准确性并发送给客户,
So that 确保账单的正确性并及时发送。

**Acceptance Criteria:**
- Given 运营人员进入结算管理页面
- When 选择需要校验的账单并点击"校验"按钮
- Then 系统对账单进行合理性检查并标记异常数据
- And 支持发送账单给客户并记录发送状态

### Story 3.4: 收款核销功能
As a 运营人员,
I want 可以记录客户的付款信息（收款核销）,
So that 跟踪账单的付款状态。

**Acceptance Criteria:**
- Given 运营人员进入收款核销页面
- When 选择待核销的账单并录入付款信息
- Then 系统匹配账单与付款并更新账单状态为已结算
- And 支持部分核销和合并核销功能

### Story 3.5: 逾期提醒功能
As a 销售负责人,
I want 可以接收客户逾期付款的自动提醒,
So that 及时跟进逾期客户。

**Acceptance Criteria:**
- Given 系统检测到客户账单逾期
- When 逾期时间达到设定阈值
- Then 系统自动发送逾期提醒给对应的销售负责人
- And 支持通过邮件和短信方式发送提醒

## Epic 4: 数据分析与报表

**目标：** 实现数据可视化和报表功能，包括实时数据看板、客户分层、风险预警和多维度数据分析。

### Story 4.1: 管理驾驶舱实时数据看板
As a 管理人员,
I want 可以通过管理驾驶舱查看实时数据看板,
So that 快速了解公司整体运营状况。

**Acceptance Criteria:**
- Given 管理人员登录系统并进入管理驾驶舱
- When 页面加载完成
- Then 显示实时数据看板（总收入、回款率、客户流失率等）
- And 支持按时间维度（日/周/月）查看数据趋势

### Story 4.2: 客户分层和风险预警
As a 管理人员,
I want 可以查看客户分层和风险预警信息,
So that 识别高价值客户和风险客户。

**Acceptance Criteria:**
- Given 管理人员进入数据分析页面
- When 点击"客户分层"模块
- Then 系统显示客户分层结果（高价值/中等/低价值）
- And 对风险客户进行红色标记和预警

### Story 4.3: 客户用量趋势分析
As a 销售负责人,
I want 可以查看客户用量趋势分析图表,
So that 了解客户的业务发展情况。

**Acceptance Criteria:**
- Given 销售负责人进入客户管理页面
- When 选择负责的客户并点击"用量趋势"
- Then 系统显示该客户的用量趋势图表
- And 支持按时间维度（月/季/年）查看趋势

### Story 4.4: 多维度报表导出
As a 所有用户,
I want 可以导出报表为多种格式（PDF、Excel、CSV、图片）,
So that 方便分享和打印报表。

**Acceptance Criteria:**
- Given 用户进入报表页面
- When 生成需要的报表并点击"导出"按钮
- Then 系统提供多种格式选择（PDF、Excel、CSV、图片）
- And 导出的报表格式正确且数据完整

### Story 4.5: 报表订阅功能
As a 所有用户,
I want 可以订阅报表并定期接收,
So that 无需手动生成和发送报表。

**Acceptance Criteria:**
- Given 用户进入报表订阅页面
- When 设置报表订阅规则（报表类型、发送频率、接收邮箱）
- Then 系统按照设定的规则定期发送报表
- And 支持取消和修改订阅规则

## Epic 5: 用户权限管理

**目标：** 实现三级权限控制（运营/销售/管理），确保数据隔离和操作权限的精细管控。

### Story 5.1: 用户账户管理
As a 系统管理员,
I want 可以创建和管理用户账户,
So that 为团队成员分配系统访问权限。

**Acceptance Criteria:**
- Given 系统管理员进入用户管理页面
- When 点击"新增用户"按钮并填写用户信息
- Then 系统验证必填字段并创建用户账户
- And 支持修改和删除用户账户

### Story 5.2: 角色分配与权限控制
As a 系统管理员,
I want 可以为用户分配角色（运营/销售/管理）和配置数据权限范围,
So that 实现精细的权限管理。

**Acceptance Criteria:**
- Given 系统管理员进入用户管理页面
- When 选择需要配置权限的用户并点击"权限配置"按钮
- Then 系统显示角色选择和数据权限配置界面
- And 支持按区域（华东/华南/华北）、客户类型（A/B/C类）等维度配置数据权限

### Story 5.3: 操作审计日志
As a 系统管理员,
I want 可以查看用户操作审计日志,
So that 追踪敏感操作的执行情况。

**Acceptance Criteria:**
- Given 系统管理员进入审计日志页面
- When 选择时间范围和操作类型进行查询
- Then 系统显示符合条件的操作记录
- And 每条记录包含操作人、时间、内容等详细信息

## Epic 6: 数据导入导出

**目标：** 实现Excel批量导入导出功能，包括数据质量验证和重复数据检测。

### Story 6.1: 数据质量验证与重复检测
As a 系统,
I want 可以对导入的数据进行质量验证（字段完整性、格式检查）和检测重复数据,
So that 确保数据质量。

**Acceptance Criteria:**
- Given 运营人员上传Excel文件进行导入
- When 系统解析数据时
- Then 对数据进行质量验证（必填字段、格式检查）
- And 检测并标记重复数据（根据公司名称、ERP系统等唯一标识）

### Story 6.3: 数据导出功能
As a 运营人员,
I want 可以导出客户信息和账单数据,
So that 进行数据分析和备份。

**Acceptance Criteria:**
- Given 运营人员进入数据导出页面
- When 选择需要导出的数据类型和时间范围
- Then 系统生成对应的Excel或CSV文件
- And 支持下载导出文件到本地

## Epic 7: 系统管理

**目标：** 实现系统参数配置、数据备份、移动端访问和系统监控功能。

### Story 7.1: 系统参数配置
As a 系统管理员,
I want 可以配置系统参数（结算周期、预警阈值等）,
So that 根据业务需求调整系统行为。

**Acceptance Criteria:**
- Given 系统管理员进入系统配置页面
- When 修改系统参数并保存
- Then 系统验证参数的有效性并更新配置
- And 提示配置成功并应用到系统

### Story 7.2: 系统运行状态监控
As a 系统管理员,
I want 可以查看系统运行状态和日志,
So that 及时发现和解决系统问题。

**Acceptance Criteria:**
- Given 系统管理员进入系统监控页面
- When 页面加载完成
- Then 显示系统运行状态（CPU、内存、磁盘使用情况）
- And 支持查看系统日志和错误信息

### Story 7.3: 数据备份与恢复
As a 系统管理员,
I want 可以管理数据备份和恢复,
So that 确保数据的安全性。

**Acceptance Criteria:**
- Given 系统管理员进入数据备份页面
- When 点击"手动备份"按钮
- Then 系统执行数据备份操作并显示备份状态
- And 支持从备份中恢复数据

### Story 7.4: 移动端访问支持
As a 所有用户,
I want 可以使用移动端访问系统,
So that 在外出时也能查看数据和进行操作。

**Acceptance Criteria:**
- Given 用户使用移动端设备（iOS/Android）访问系统
- When 页面加载完成
- Then 显示响应式界面并支持核心功能（客户查询、账单查看、逾期提醒、报表导出）
- And 操作流程简洁，符合移动端交互习惯