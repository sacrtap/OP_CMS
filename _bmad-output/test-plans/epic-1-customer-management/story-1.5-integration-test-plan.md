# Story 1.5 客户信息查看权限 - 集成测试计划

**文档版本:** 1.0  
**创建日期:** 2026-02-25  
**最后更新:** 2026-02-25  
**测试负责人:** QA Team  
**测试类型:** 集成测试  

---

## 修订记录

| 版本 | 日期 | 作者 | 变更描述 | 审核状态 |
|------|------|------|----------|----------|
| 1.0 | 2026-02-25 | QA Team | 初始版本创建 | 待审核 |
| | | | | |

---

## 目录

1. [测试计划概述](#1-测试计划概述)
2. [测试范围](#2-测试范围)
3. [测试策略](#3-测试策略)
4. [测试环境](#4-测试环境)
5. [测试数据准备](#5-测试数据准备)
6. [测试用例清单](#6-测试用例清单)
7. [测试执行计划](#7-测试执行计划)
8. [风险评估](#8-风险评估)
9. [准入和准出标准](#9-准入和准出标准)
10. [附录](#10-附录)

---

## 1. 测试计划概述

### 1.1 测试目标

验证 Story 1.5 客户信息查看权限功能的集成测试，确保：
- 角色权限控制正确（admin/supervisor/operator/viewer）
- 客户级权限分配生效
- 数据脱敏功能正常
- 访问日志记录完整

### 1.2 测试范围

**包含的功能模块：**
- 角色权限定义和验证
- 客户级权限分配
- 敏感字段数据脱敏
- 访问日志记录

**不包含的测试内容：**
- 客户基础 CRUD 功能
- 用户认证功能

### 1.3 参考资料

- 需求文档：`_bmad-output/implementation-artifacts/stories/1-5-客户信息查看权限.md`

---

## 2. 测试范围

### 2.1 功能特性测试

| 特性 | 优先级 | 用例数 |
|------|--------|--------|
| F-1.5.1 角色权限定义 | P0 | 8 |
| F-1.5.2 客户级权限 | P0 | 8 |
| F-1.5.3 数据脱敏 | P0 | 10 |
| F-1.5.4 权限审计 | P1 | 6 |

### 2.2 集成接口测试

| 接口 | 优先级 | 用例数 |
|------|--------|--------|
| GET /api/v1/customers - 权限过滤 | P0 | 6 |
| GET /api/v1/customers/:id - 权限验证 | P0 | 6 |
| GET /api/v1/access-logs - 日志查询 | P1 | 4 |

### 2.3 UI 集成测试

| UI 组件 | 优先级 | 用例数 |
|---------|--------|--------|
| 权限分配界面 | P1 | 6 |
| 脱敏字段显示 | P0 | 6 |
| 访问日志查看 | P1 | 4 |

---

## 3. 测试策略

### 3.1 测试方法

- 多角色账号测试
- 权限边界测试
- 数据脱敏验证
- 审计日志检查

### 3.2 测试重点

1. **权限控制**
   - 角色权限验证
   - 客户级授权
   - 越权访问阻止

2. **数据安全**
   - 脱敏算法正确
   - 脱敏规则配置
   - 敏感字段保护

3. **审计追踪**
   - 访问日志完整
   - 日志查询功能

---

## 4. 测试环境

### 4.1 用户角色准备

| 角色 | 账号 | 权限 |
|------|------|------|
| admin | admin@test.com | 全部权限 |
| supervisor | supervisor@test.com | 主管权限 |
| operator | operator@test.com | 运营人员权限 |
| viewer | viewer@test.com | 只读权限 |

### 4.2 测试数据

- 准备 10 个客户数据
- 准备权限分配记录
- 准备脱敏规则配置

---

## 5. 测试用例清单

### 5.1 功能特性测试

#### F-1.5.1 角色权限定义

| 用例 ID | 测试场景 | 优先级 |
|--------|---------|--------|
| TC-F1.5.1-01 | admin 查看全部字段 | P0 |
| TC-F1.5.1-02 | supervisor 查看全部字段 | P0 |
| TC-F1.5.1-03 | operator 查看部分字段 | P0 |
| TC-F1.5.1-04 | viewer 查看脱敏字段 | P0 |
| TC-F1.5.1-05 | 无权限用户阻止访问 | P0 |
| TC-F1.5.1-06 | 角色切换权限更新 | P1 |
| TC-F1.5.1-07 | 权限缓存刷新 | P1 |
| TC-F1.5.1-08 | 权限继承验证 | P2 |

#### F-1.5.2 客户级权限

| 用例 ID | 测试场景 | 优先级 |
|--------|---------|--------|
| TC-F1.5.2-01 | 授权用户查看完整信息 | P0 |
| TC-F1.5.2-02 | 未授权用户查看受限 | P0 |
| TC-F1.5.2-03 | 权限分配功能 | P0 |
| TC-F1.5.2-04 | 权限回收功能 | P1 |
| TC-F1.5.2-05 | 批量权限分配 | P1 |
| TC-F1.5.2-06 | 权限继承（部门级） | P2 |
| TC-F1.5.2-07 | 权限过期处理 | P2 |
| TC-F1.5.2-08 | 权限列表查看 | P1 |

#### F-1.5.3 数据脱敏

| 用例 ID | 测试场景 | 优先级 |
|--------|---------|--------|
| TC-F1.5.3-01 | 手机号脱敏 - 中间 4 位 | P0 |
| TC-F1.5.3-02 | 邮箱脱敏 - 用户名部分 | P0 |
| TC-F1.5.3-03 | 信用代码脱敏 - 中间部分 | P0 |
| TC-F1.5.3-04 | 联系人脱敏（可选） | P1 |
| TC-F1.5.3-05 | 地址脱敏（可选） | P1 |
| TC-F1.5.3-06 | 脱敏规则配置 | P1 |
| TC-F1.5.3-07 | 脱敏开关 | P1 |
| TC-F1.5.3-08 | 前端脱敏显示 | P0 |
| TC-F1.5.3-09 | 后端脱敏返回 | P0 |
| TC-F1.5.3-10 | 前后端脱敏一致 | P0 |

#### F-1.5.4 权限审计

| 用例 ID | 测试场景 | 优先级 |
|--------|---------|--------|
| TC-F1.5.4-01 | 访问日志自动记录 | P1 |
| TC-F1.5.4-02 | 记录访问用户 | P1 |
| TC-F1.5.4-03 | 记录访问时间 | P1 |
| TC-F1.5.4-04 | 记录访问字段 | P1 |
| TC-F1.5.4-05 | 日志查询功能 | P1 |
| TC-F1.5.4-06 | 日志导出功能 | P2 |

---

## 6. 测试执行计划

### 6.1 测试阶段

1. **角色权限测试**: 2 小时
2. **客户级权限测试**: 2 小时
3. **数据脱敏测试**: 3 小时
4. **权限审计测试**: 2 小时

### 6.2 测试周期

| 活动 | 日期 | 工作日 |
|------|------|--------|
| 测试准备 | 2026-02-26 | 1 |
| 测试执行 | 2026-02-27 ~ 2026-03-01 | 3 |
| 缺陷修复 | 2026-03-02 ~ 2026-03-04 | 3 |
| 测试报告 | 2026-03-05 | 1 |

---

## 7. 风险评估

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 权限漏洞 | 中 | 高 | 全面测试越权场景 |
| 脱敏不一致 | 中 | 高 | 前后端统一脱敏 |
| 性能影响 | 低 | 中 | 优化权限检查逻辑 |

---

## 8. 准入和准出标准

### 8.1 准入标准

- [ ] 4 个角色账号创建完成
- [ ] 权限配置完成
- [ ] 脱敏规则配置完成

### 8.2 准出标准

- [ ] P0 用例 100% 通过
- [ ] 无权限漏洞
- [ ] 脱敏功能正常

---

**文档结束**
