# Story 1.4 客户数据 Excel 批量导入 - 集成测试计划

**文档版本:** 1.0  
**创建日期:** 2026-02-25  
**最后更新:** 2026-02-25  
**测试负责人:** QA Team  
**测试类型:** 集成测试  

---

## 修订记录

| 版本 | 日期 | 作者 | 变更描述 | 审核状态 |
|------|------|------|----------|----------|
| 1.0 | 2026-02-25 | QA Team | 初始版本创建 | 待审核 |
| | | | | |

---

## 目录

1. [测试计划概述](#1-测试计划概述)
2. [测试范围](#2-测试范围)
3. [测试策略](#3-测试策略)
4. [测试环境](#4-测试环境)
5. [测试数据准备](#5-测试数据准备)
6. [测试用例清单](#6-测试用例清单)
7. [测试执行计划](#7-测试执行计划)
8. [风险评估与缓解](#8-风险评估与缓解)
9. [准入和准出标准](#9-准入和准出标准)
10. [附录](#10-附录)

---

## 1. 测试计划概述

### 1.1 测试目标

验证 Story 1.4 客户数据 Excel 批量导入功能的集成测试，确保：
- Excel 模板下载功能正常
- Excel 文件上传和解析正确
- 数据验证准确（必填、格式、重复）
- 批量导入执行成功（事务处理）
- 导入结果反馈完整
- 性能满足要求（1000+ records in <30s）

### 1.2 测试范围

**包含的功能模块：**
- Excel 模板下载
- Excel 文件上传
- 数据解析和验证
- 批量导入执行
- 导入结果展示
- 错误报告下载

**不包含的测试内容：**
- 单个客户新增/编辑（Story 1.1、1.3 范围）
- 性能压力测试（单独测试计划）

### 1.3 参考资料

- 需求文档：`_bmad-output/implementation-artifacts/stories/1-4-客户数据 excel 批量导入.md`

---

## 2. 测试范围

### 2.1 功能特性测试

| 特性编号 | 特性名称 | 优先级 | 测试用例数 |
|---------|---------|--------|-----------|
| F-1.4.1 | Excel 模板下载 | P0 | 4 |
| F-1.4.2 | Excel 文件上传 | P0 | 6 |
| F-1.4.3 | 数据验证功能 | P0 | 12 |
| F-1.4.4 | 批量导入执行 | P0 | 8 |
| F-1.4.5 | 导入结果展示 | P1 | 6 |
| F-1.4.6 | 错误报告下载 | P1 | 4 |

### 2.2 集成接口测试

| 接口编号 | 接口名称 | 优先级 | 测试用例数 |
|---------|---------|--------|-----------|
| I-1.4.1 | GET /api/v1/customers/import-template | P0 | 2 |
| I-1.4.2 | POST /api/v1/customers/import - 上传 | P0 | 8 |
| I-1.4.3 | POST /api/v1/customers/import/execute | P0 | 6 |
| I-1.4.4 | 数据库批量插入 | P0 | 4 |

### 2.3 用户界面集成测试

| UI 编号 | 界面名称 | 优先级 | 测试用例数 |
|--------|---------|--------|-----------|
| UI-1.4.1 | 导入页面 | P0 | 6 |
| UI-1.4.2 | 上传区域 | P0 | 6 |
| UI-1.4.3 | 数据预览表格 | P1 | 6 |
| UI-1.4.4 | 导入进度显示 | P0 | 4 |
| UI-1.4.5 | 结果展示界面 | P1 | 6 |

---

## 3. 测试策略

### 3.1 测试方法

**端到端测试为主：**
- 完整导入流程测试
- 文件上传和解析验证
- 数据验证准确性测试
- 批量导入性能测试
- 错误处理测试

### 3.2 测试重点

1. **数据验证**
   - 必填字段验证
   - 格式验证（手机号、邮箱、信用代码）
   - 重复数据检测
   - 批量验证性能

2. **事务完整性**
   - 批量导入原子性
   - 失败回滚机制
   - 部分成功处理

3. **用户体验**
   - 拖拽上传
   - 进度显示
   - 错误报告清晰

### 3.3 测试数据

**Excel 测试文件：**
1. 正常数据文件（100 条有效数据）
2. 包含错误数据文件（混合有效和无效）
3. 超大文件（1000+ 条数据）
4. 空文件
5. 格式错误文件

---

## 4. 测试环境

### 4.1 环境要求

```
前端 (Vue 3 + Arco) → 后端 (Python Sanic + openpyxl) → MySQL 8.0+
```

### 4.2 性能基准

| 操作 | 数据量 | 响应时间要求 |
|------|--------|-------------|
| 文件上传和解析 | 100 条 | <5s |
| 数据验证 | 100 条 | <3s |
| 批量导入 | 100 条 | <10s |
| 批量导入 | 1000 条 | <30s |

---

## 5. 测试数据准备

### 5.1 Excel 模板结构

| 列名 | 必填 | 格式 | 示例 |
|------|------|------|------|
| 公司名称 | 是 | 文本 | 上海科技有限公司 |
| 联系人 | 是 | 文本 | 张三 |
| 联系电话 | 是 | 11 位数字 | 13800138000 |
| 统一社会信用代码 | 是 | 18 位 | 91310000MA1K3YJ12X |
| 客户类型 | 否 | 枚举 | enterprise |
| 省份 | 否 | 文本 | Shanghai |
| 城市 | 否 | 文本 | Shanghai |
| 邮箱 | 否 | 邮箱格式 | test@example.com |

### 5.2 测试文件

**测试文件 1: valid_customers.xlsx**
- 100 条有效数据
- 所有必填字段完整
- 格式正确

**测试文件 2: mixed_data.xlsx**
- 80 条有效数据
- 10 条必填字段缺失
- 5 条格式错误
- 5 条重复数据

**测试文件 3: large_import.xlsx**
- 1000 条有效数据
- 用于性能测试

---

## 6. 测试用例清单

### 6.1 功能特性测试

#### F-1.4.1 Excel 模板下载

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.4.1-01 | 下载模板按钮显示 | P0 | 页面显示下载按钮 |
| TC-F1.4.1-02 | 下载模板文件 | P0 | 点击下载模板 |
| TC-F1.4.1-03 | 模板文件格式 | P0 | .xlsx 格式 |
| TC-F1.4.1-04 | 模板内容验证 | P0 | 包含所有字段和示例 |

#### F-1.4.2 Excel 文件上传

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.4.2-01 | 拖拽上传功能 | P0 | 拖拽文件到上传区 |
| TC-F1.4.2-02 | 点击上传功能 | P0 | 点击选择文件 |
| TC-F1.4.2-03 | 文件格式验证 | P0 | 仅支持.xlsx |
| TC-F1.4.2-04 | 文件大小限制 | P1 | 超过限制提示 |
| TC-F1.4.2-05 | 上传进度显示 | P1 | 显示上传进度条 |
| TC-F1.4.2-06 | 取消上传 | P2 | 上传中取消 |

#### F-1.4.3 数据验证功能

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.4.3-01 | 必填字段验证 - 缺失 | P0 | 验证必填字段 |
| TC-F1.4.3-02 | 手机号格式验证 | P0 | 验证手机号格式 |
| TC-F1.4.3-03 | 邮箱格式验证 | P0 | 验证邮箱格式 |
| TC-F1.4.3-04 | 信用代码长度验证 | P0 | 验证 18 位 |
| TC-F1.4.3-05 | 信用代码格式验证 | P0 | 验证格式正确 |
| TC-F1.4.3-06 | 公司名称重复检测 | P0 | 检测重复公司 |
| TC-F1.4.3-07 | 信用代码重复检测 | P0 | 检测重复代码 |
| TC-F1.4.3-08 | 批量重复检测 | P0 | Excel 内部重复 |
| TC-F1.4.3-09 | 客户类型枚举验证 | P1 | 验证枚举值 |
| TC-F1.4.3-10 | 省份有效性验证 | P1 | 验证省份 |
| TC-F1.4.3-11 | 验证错误计数 | P1 | 显示错误数量 |
| TC-F1.4.3-12 | 验证结果预览 | P1 | 预览前 10 条 |

#### F-1.4.4 批量导入执行

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.4.4-01 | 导入全部有效数据 | P0 | 100 条成功导入 |
| TC-F1.4.4-02 | 跳过错误数据导入 | P0 | 导入有效数据 |
| TC-F1.4.4-03 | 事务处理 - 全部成功 | P0 | 原子性测试 |
| TC-F1.4.4-04 | 事务处理 - 失败回滚 | P0 | 回滚测试 |
| TC-F1.4.4-05 | 导入进度显示 | P0 | 实时进度 |
| TC-F1.4.4-06 | 取消导入 | P1 | 导入中取消 |
| TC-F1.4.4-07 | 导入性能 - 100 条 | P0 | <10s |
| TC-F1.4.4-08 | 导入性能 - 1000 条 | P1 | <30s |

#### F-1.4.5 导入结果展示

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.4.5-01 | 成功数量显示 | P1 | 显示成功条数 |
| TC-F1.4.5-02 | 失败数量显示 | P1 | 显示失败条数 |
| TC-F1.4.5-03 | 错误详情列表 | P1 | 显示错误明细 |
| TC-F1.4.5-04 | 导入成功通知 | P1 | 成功提示 |
| TC-F1.4.5-05 | 导入失败通知 | P1 | 失败提示 |
| TC-F1.4.5-06 | 刷新客户列表 | P1 | 导入后刷新 |

#### F-1.4.6 错误报告下载

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.4.6-01 | 下载错误报告按钮 | P1 | 显示下载按钮 |
| TC-F1.4.6-02 | 错误报告格式 | P1 | Excel 格式 |
| TC-F1.4.6-03 | 错误报告内容 | P1 | 包含错误信息 |
| TC-F1.4.6-04 | 错误行号标注 | P1 | 标注错误行 |

---

## 7. 测试执行计划

### 7.1 测试阶段

**阶段 1: 模板和上传测试**
- 测试模板下载
- 测试文件上传
- 预计时间：2 小时

**阶段 2: 数据验证测试**
- 测试各种验证场景
- 预计时间：4 小时

**阶段 3: 批量导入测试**
- 测试导入执行
- 测试事务处理
- 预计时间：4 小时

**阶段 4: 性能和 UI 测试**
- 性能测试
- UI 集成测试
- 预计时间：2 小时

### 7.2 测试周期

| 活动 | 日期 | 工作日 |
|------|------|--------|
| 测试数据准备 | 2026-02-26 | 1 |
| 测试执行 | 2026-02-27 ~ 2026-03-02 | 4 |
| 缺陷修复 | 2026-03-03 ~ 2026-03-05 | 3 |
| 测试报告 | 2026-03-06 | 1 |

---

## 8. 风险评估

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 大文件上传超时 | 中 | 高 | 分块上传或增加超时 |
| 内存溢出 | 中 | 高 | 流式解析 Excel |
| 验证性能差 | 中 | 中 | 批量验证优化 |

---

## 9. 准入和准出标准

### 9.1 准入标准

- [ ] Excel 解析库安装 (openpyxl)
- [ ] 测试 Excel 文件准备完成
- [ ] 导入功能开发完成

### 9.2 准出标准

- [ ] P0 测试用例 100% 通过
- [ ] 性能达标（1000 条<30s）
- [ ] 所有缺陷修复

---

## 10. 附录

### 10.1 Excel 测试文件生成脚本

```python
import openpyxl

wb = openpyxl.Workbook()
ws = wb.active
ws.append(['公司名称', '联系人', '联系电话', '统一社会信用代码', ...])
for i in range(100):
    ws.append([f'测试公司{i}', f'张三{i}', f'13800138{i:03d}', ...])
wb.save('test_import.xlsx')
```

---

**文档结束**
