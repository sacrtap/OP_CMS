# Story 1.3 客户信息编辑与删除 - 集成测试计划

**文档版本:** 1.0  
**创建日期:** 2026-02-25  
**最后更新:** 2026-02-25  
**测试负责人:** QA Team  
**测试类型:** 集成测试  

---

## 修订记录

| 版本 | 日期 | 作者 | 变更描述 | 审核状态 |
|------|------|------|----------|----------|
| 1.0 | 2026-02-25 | QA Team | 初始版本创建 | 待审核 |
| | | | | |

---

## 目录

1. [测试计划概述](#1-测试计划概述)
2. [测试范围](#2-测试范围)
3. [测试策略](#3-测试策略)
4. [测试环境](#4-测试环境)
5. [测试数据准备](#5-测试数据准备)
6. [测试用例清单](#6-测试用例清单)
7. [测试执行计划](#7-测试执行计划)
8. [风险评估与缓解](#8-风险评估与缓解)
9. [准入和准出标准](#9-准入和准出标准)
10. [附录](#10-附录)

---

## 1. 测试计划概述

### 1.1 测试目标

验证 Story 1.3 客户信息编辑与删除功能的集成测试，确保：
- 编辑客户信息功能正常工作
- 数据验证和唯一性检查有效
- 修改日志记录完整
- 删除客户功能正确（包括删除保护）
- 级联删除关联数据

### 1.2 测试范围

**包含的功能模块：**
- 客户信息编辑功能
- 数据验证和唯一性检查
- 修改日志记录
- 客户删除功能
- 删除保护（关联数据检查）
- 级联删除

**不包含的测试内容：**
- 单元测试（由开发完成）
- 客户新增功能（Story 1.1 范围）
- 客户搜索功能（Story 1.2 范围）

### 1.3 参考资料

- 需求文档：`_bmad-output/implementation-artifacts/stories/1-3-客户信息编辑与删除.md`
- Story 1.1 测试计划（基础 CRUD 参考）
- 数据库设计文档

---

## 2. 测试范围

### 2.1 功能特性测试

| 特性编号 | 特性名称 | 优先级 | 测试用例数 |
|---------|---------|--------|-----------|
| F-1.3.1 | 编辑客户信息功能 | P0 | 10 |
| F-1.3.2 | 编辑数据验证 | P0 | 8 |
| F-1.3.3 | 修改日志记录 | P1 | 6 |
| F-1.3.4 | 删除客户功能 | P0 | 8 |
| F-1.3.5 | 删除保护 | P0 | 6 |
| F-1.3.6 | 级联删除 | P1 | 4 |

### 2.2 集成接口测试

| 接口编号 | 接口名称 | 优先级 | 测试用例数 |
|---------|---------|--------|-----------|
| I-1.3.1 | PUT /api/v1/customers/:id - 更新客户 | P0 | 8 |
| I-1.3.2 | DELETE /api/v1/customers/:id - 删除客户 | P0 | 6 |
| I-1.3.3 | GET /api/v1/customers/:id/change-logs - 修改日志 | P1 | 3 |

### 2.3 用户界面集成测试

| UI 编号 | 界面名称 | 优先级 | 测试用例数 |
|--------|---------|--------|-----------|
| UI-1.3.1 | 编辑按钮和入口 | P0 | 4 |
| UI-1.3.2 | 编辑表单界面 | P0 | 8 |
| UI-1.3.3 | 删除确认对话框 | P0 | 6 |
| UI-1.3.4 | 删除保护提示 | P0 | 4 |
| UI-1.3.5 | 修改历史查看 | P1 | 4 |

---

## 3. 测试策略

### 3.1 测试方法

**黑盒测试 + 灰盒测试：**
- 通过前端界面执行编辑和删除场景
- 验证 API 请求和响应
- 检查数据库数据变更
- 验证修改日志记录
- 测试关联数据级联删除

### 3.2 测试重点

1. **数据完整性**
   - 部分字段更新不影响其他字段
   - 关键字段修改的验证
   - 唯一性约束检查

2. **删除安全性**
   - 删除前确认机制
   - 关联数据检查
   - 级联删除完整性

3. **审计追踪**
   - 修改日志完整性
   - 修改前后值记录
   - 修改人和时间记录

### 3.3 测试工具

| 工具名称 | 用途 | 版本 |
|---------|------|------|
| Vitest + @vue/test-utils | 前端集成测试 | ^1.6.0 + ^2.4.0 |
| Playwright | E2E 测试 | ^1.40.0 |
| MySQL Client | 数据库验证 | 8.0+ |

---

## 4. 测试环境

### 4.1 数据依赖

**测试数据要求：**
- 至少 10 个客户用于编辑测试
- 至少 3 个客户有关联价格配置
- 至少 2 个客户有关联结算记录
- 至少 1 个客户无任何关联数据

### 4.2 环境配置

```
测试环境架构：
前端 → 后端 API → MySQL 8.0+
          ↓
      修改日志表
```

---

## 5. 测试数据准备

### 5.1 基础测试数据

```sql
-- 准备测试客户
INSERT INTO customers (company_name, contact_name, contact_phone, status)
VALUES 
  ('编辑测试公司', '张三', '13800138000', 'active'),
  ('删除测试公司', '李四', '13900139000', 'active'),
  ('有关联数据公司', '王五', '13700137000', 'active');

-- 准备价格配置关联数据
INSERT INTO price_configs (customer_id, unit_price, device_series)
VALUES (3, 0.10, 'X');

-- 准备结算记录关联数据
INSERT INTO settlement_records (customer_id, amount, status)
VALUES (3, 1000.00, 'pending');
```

### 5.2 修改日志测试数据

**修改日志表结构：**
```sql
customer_change_logs:
- id
- customer_id
- changed_by (user_id)
- changed_at
- changes: JSON {field, old_value, new_value}
```

---

## 6. 测试用例清单

### 6.1 功能特性测试用例

#### F-1.3.1 编辑客户信息功能

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.3.1-01 | 编辑单个字段 | P0 | 仅修改联系方式 |
| TC-F1.3.1-02 | 编辑多个字段 | P0 | 同时修改多个字段 |
| TC-F1.3.1-03 | 编辑必填字段 | P0 | 修改公司名称 |
| TC-F1.3.1-04 | 编辑后保存 | P0 | 保存修改并验证 |
| TC-F1.3.1-05 | 编辑后取消 | P1 | 取消修改恢复原值 |
| TC-F1.3.1-06 | 编辑后列表刷新 | P1 | 列表显示更新数据 |
| TC-F1.3.1-07 | 编辑详情页刷新 | P1 | 详情页显示更新 |
| TC-F1.3.1-08 | 并发编辑处理 | P2 | 两人同时编辑 |
| TC-F1.3.1-09 | 编辑历史记录 | P1 | 查看修改历史 |
| TC-F1.3.1-10 | 编辑权限验证 | P1 | 无权限用户不可编辑 |

#### F-1.3.2 编辑数据验证

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.3.2-01 | 必填字段验证 | P0 | 清空必填字段 |
| TC-F1.3.2-02 | 手机号格式验证 | P0 | 输入错误格式 |
| TC-F1.3.2-03 | 邮箱格式验证 | P0 | 输入错误格式 |
| TC-F1.3.2-04 | 公司名称唯一性 | P0 | 改为已存在的名称 |
| TC-F1.3.2-05 | 信用代码唯一性 | P0 | 改为已存在的代码 |
| TC-F1.3.2-06 | 字段长度验证 | P1 | 超长公司名称 |
| TC-F1.3.2-07 | 前后端验证一致 | P0 | 验证规则一致 |
| TC-F1.3.2-08 | 错误提示友好性 | P1 | 提示清晰 |

#### F-1.3.3 修改日志记录

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.3.3-01 | 记录修改字段 | P1 | 验证字段被记录 |
| TC-F1.3.3-02 | 记录修改前后值 | P1 | old 和 new 值正确 |
| TC-F1.3.3-03 | 记录修改人 | P1 | changed_by 正确 |
| TC-F1.3.3-04 | 记录修改时间 | P1 | changed_at 正确 |
| TC-F1.3.3-05 | 多次修改记录 | P1 | 多条日志正确 |
| TC-F1.3.3-06 | 查看修改历史 | P1 | UI 显示日志 |

#### F-1.3.4 删除客户功能

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.3.4-01 | 删除无关联客户 | P0 | 成功删除 |
| TC-F1.3.4-02 | 删除确认对话框 | P0 | 显示确认提示 |
| TC-F1.3.4-03 | 确认删除操作 | P0 | 点击确认删除 |
| TC-F1.3.4-04 | 取消删除操作 | P1 | 点击取消保留 |
| TC-F1.3.4-05 | 删除后列表刷新 | P1 | 列表移除客户 |
| TC-F1.3.4-06 | 删除成功提示 | P1 | 显示成功通知 |
| TC-F1.3.4-07 | 删除后数据库验证 | P0 | 数据库无记录 |
| TC-F1.3.4-08 | 批量删除（如支持） | P2 | 删除多个客户 |

#### F-1.3.5 删除保护

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.3.5-01 | 检查价格配置关联 | P0 | 提示有关联数据 |
| TC-F1.3.5-02 | 检查结算记录关联 | P0 | 提示有结算记录 |
| TC-F1.3.5-03 | 删除保护提示 | P0 | 显示警告信息 |
| TC-F1.3.5-04 | 阻止删除 | P0 | 删除失败 |
| TC-F1.3.5-05 | 二次确认删除 | P1 | 强制删除确认 |
| TC-F1.3.5-06 | 关联数据列表 | P1 | 显示关联数据明细 |

#### F-1.3.6 级联删除

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.3.6-01 | 级联删除价格配置 | P1 | 价格配置被删除 |
| TC-F1.3.6-02 | 级联删除结算记录 | P1 | 结算记录被删除 |
| TC-F1.3.6-03 | 级联删除完整性 | P1 | 所有关联数据删除 |
| TC-F1.3.6-04 | 级联删除事务 | P0 | 事务回滚测试 |

### 6.2 集成接口测试用例

#### I-1.3.1 PUT /api/v1/customers/:id - 更新客户

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-I1.3.1-01 | 成功更新客户 | P0 | 完整数据更新 |
| TC-I1.3.1-02 | 部分字段更新 | P0 | 仅更新部分字段 |
| TC-I1.3.1-03 | 必填字段缺失 | P0 | 更新失败 |
| TC-I1.3.1-04 | 格式验证失败 | P0 | 手机号错误 |
| TC-I1.3.1-05 | 唯一性验证失败 | P0 | 重复公司名称 |
| TC-I1.3.1-06 | 客户不存在 | P1 | 404 错误 |
| TC-I1.3.1-07 | 认证失败 | P0 | 401 错误 |
| TC-I1.3.1-08 | 修改日志生成 | P1 | 验证日志创建 |

#### I-1.3.2 DELETE /api/v1/customers/:id - 删除客户

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-I1.3.2-01 | 成功删除无关联客户 | P0 | 204 No Content |
| TC-I1.3.2-02 | 删除有关联客户 | P0 | 409 Conflict |
| TC-I1.3.2-03 | 客户不存在 | P1 | 404 Not Found |
| TC-I1.3.2-04 | 认证失败 | P0 | 401 Unauthorized |
| TC-I1.3.2-05 | 级联删除验证 | P1 | 关联数据删除 |
| TC-I1.3.2-06 | 事务回滚测试 | P1 | 删除失败回滚 |

#### I-1.3.3 修改日志查询

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-I1.3.3-01 | 查询修改日志列表 | P1 | 返回日志列表 |
| TC-I1.3.3-02 | 查询日志详情 | P1 | 返回详细变更 |
| TC-I1.3.3-03 | 无日志记录 | P1 | 返回空列表 |

### 6.3 用户界面集成测试用例

#### UI-1.3.1 编辑按钮和入口

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.3.1-01 | 列表行编辑按钮 | P0 | 显示编辑按钮 |
| TC-UI1.3.1-02 | 详情页编辑按钮 | P0 | 显示编辑按钮 |
| TC-UI1.3.1-03 | 编辑按钮权限 | P1 | 无权限不显示 |
| TC-UI1.3.1-04 | 按钮可用状态 | P1 | 可点击 |

#### UI-1.3.2 编辑表单界面

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.3.2-01 | 表单加载数据 | P0 | 显示当前值 |
| TC-UI1.3.2-02 | 表单字段完整性 | P0 | 所有字段可见 |
| TC-UI1.3.2-03 | 必填字段标识 | P1 | 红色星号 |
| TC-UI1.3.2-04 | 表单验证提示 | P0 | 错误提示 |
| TC-UI1.3.2-05 | 保存按钮功能 | P0 | 提交修改 |
| TC-UI1.3.2-06 | 取消按钮功能 | P1 | 关闭表单 |
| TC-UI1.3.2-07 | 表单自动关闭 | P1 | 保存后关闭 |
| TC-UI1.3.2-08 | 表单布局响应式 | P1 | 自适应 |

#### UI-1.3.3 删除确认对话框

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.3.3-01 | 对话框显示 | P0 | 弹出确认框 |
| TC-UI1.3.3-02 | 确认按钮 | P0 | 执行删除 |
| TC-UI1.3.3-03 | 取消按钮 | P1 | 关闭对话框 |
| TC-UI1.3.3-04 | 警告图标显示 | P1 | 显示警告 |
| TC-UI1.3.3-05 | 提示文字清晰 | P1 | 说明后果 |
| TC-UI1.3.3-06 | 对话框关闭 | P1 | 点击 X 关闭 |

#### UI-1.3.4 删除保护提示

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.3.4-01 | 关联数据警告 | P0 | 显示警告信息 |
| TC-UI1.3.4-02 | 关联数据列表 | P1 | 显示明细 |
| TC-UI1.3.4-03 | 阻止删除提示 | P0 | 提示删除失败 |
| TC-UI1.3.4-04 | 建议操作提示 | P1 | 建议先处理关联数据 |

#### UI-1.3.5 修改历史查看

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.3.5-01 | 修改历史入口 | P1 | 显示查看按钮 |
| TC-UI1.3.5-02 | 历史记录列表 | P1 | 显示时间线 |
| TC-UI1.3.5-03 | 修改详情展开 | P1 | 显示变更内容 |
| TC-UI1.3.5-04 | 修改人显示 | P1 | 显示操作人 |

---

## 7. 测试执行计划

### 7.1 测试阶段

**阶段 1: 编辑功能测试**
- 执行编辑功能测试用例
- 验证数据更新和验证
- 预计时间：4 小时

**阶段 2: 删除功能测试**
- 执行删除功能测试用例
- 验证删除保护和级联
- 预计时间：3 小时

**阶段 3: 修改日志测试**
- 验证日志记录功能
- 检查日志完整性
- 预计时间：2 小时

**阶段 4: UI 集成测试**
- 执行界面交互测试
- 验证用户体验
- 预计时间：3 小时

### 7.2 测试周期

| 活动 | 开始日期 | 结束日期 | 工作日 |
|------|---------|---------|-------|
| 测试数据准备 | 2026-02-26 | 2026-02-26 | 1 |
| 测试用例执行 | 2026-02-27 | 2026-03-02 | 4 |
| 缺陷修复和回归 | 2026-03-03 | 2026-03-05 | 3 |
| 测试报告编写 | 2026-03-06 | 2026-03-06 | 1 |

---

## 8. 风险评估与缓解

### 8.1 数据完整性风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 部分更新导致数据丢失 | 中 | 高 | 严格测试部分字段更新 |
| 级联删除遗漏 | 中 | 高 | 列出所有关联表逐一验证 |

### 8.2 安全性风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 越权编辑/删除 | 中 | 高 | 测试权限验证 |
| 删除保护被绕过 | 低 | 高 | 后端强制检查 |

---

## 9. 准入和准出标准

### 9.1 测试准入标准

- [ ] 编辑和删除功能开发完成
- [ ] 关联数据测试准备完成
- [ ] 测试环境准备就绪

### 9.2 测试准出标准

- [ ] 所有 P0 测试用例 100% 通过
- [ ] P1 测试用例 95% 以上通过
- [ ] 删除保护功能正常工作
- [ ] 修改日志记录完整

---

## 10. 附录

### 10.1 修改日志格式

```json
{
  "changes": [
    {
      "field": "contact_phone",
      "old_value": "13800138000",
      "new_value": "13900139000"
    }
  ]
}
```

### 10.2 参考文档

1. `_bmad-output/implementation-artifacts/stories/1-3-客户信息编辑与删除.md`
2. Story 1.1 测试计划

---

**文档结束**
