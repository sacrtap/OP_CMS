# Story 1.2 客户信息查询与搜索 - 集成测试计划

**文档版本:** 1.0  
**创建日期:** 2026-02-25  
**最后更新:** 2026-02-25  
**测试负责人:** QA Team  
**测试类型:** 集成测试  

---

## 修订记录

| 版本 | 日期 | 作者 | 变更描述 | 审核状态 |
|------|------|------|----------|----------|
| 1.0 | 2026-02-25 | QA Team | 初始版本创建 | 待审核 |
| | | | | |

---

## 目录

1. [测试计划概述](#1-测试计划概述)
2. [测试范围](#2-测试范围)
3. [测试策略](#3-测试策略)
4. [测试环境](#4-测试环境)
5. [测试数据准备](#5-测试数据准备)
6. [测试用例清单](#6-测试用例清单)
7. [测试执行计划](#7-测试执行计划)
8. [风险评估与缓解](#8-风险评估与缓解)
9. [准入和准出标准](#9-准入和准出标准)
10. [附录](#10-附录)

---

## 1. 测试计划概述

### 1.1 测试目标

验证 Story 1.2 客户信息查询与搜索功能的集成测试，确保：
- 关键词搜索功能正常工作（模糊匹配）
- 多条件筛选功能正确集成
- 高级搜索和组合查询功能完整
- 搜索结果排序功能正常
- 搜索性能达到要求（<500ms for 10k records）

### 1.2 测试范围

**包含的功能模块：**
- 关键词搜索功能
- 多条件筛选功能
- 高级搜索功能
- 搜索结果排序功能
- 搜索条件保存功能（可选）

**不包含的测试内容：**
- 单元测试（由开发人员完成）
- 客户基础 CRUD 功能（Story 1.1 范围）
- 性能压力测试（单独的性能测试计划）

### 1.3 参考资料

- 需求文档：`_bmad-output/implementation-artifacts/stories/1-2-客户信息查询与搜索.md`
- Story 1.1 测试计划（基础功能依赖）
- API 文档：（待补充）

---

## 2. 测试范围

### 2.1 功能特性测试

| 特性编号 | 特性名称 | 优先级 | 测试用例数 |
|---------|---------|--------|-----------|
| F-1.2.1 | 关键词搜索功能 | P0 | 10 |
| F-1.2.2 | 多条件筛选功能 | P0 | 12 |
| F-1.2.3 | 高级搜索功能 | P1 | 8 |
| F-1.2.4 | 搜索结果排序 | P1 | 6 |
| F-1.2.5 | 搜索条件保存 | P2 | 4 |

### 2.2 集成接口测试

| 接口编号 | 接口名称 | 优先级 | 测试用例数 |
|---------|---------|--------|-----------|
| I-1.2.1 | GET /api/v1/customers - 搜索参数验证 | P0 | 12 |
| I-1.2.2 | 数据库索引优化验证 | P1 | 4 |
| I-1.2.3 | 搜索缓存机制（如有） | P2 | 3 |

### 2.3 用户界面集成测试

| UI 编号 | 界面名称 | 优先级 | 测试用例数 |
|--------|---------|--------|-----------|
| UI-1.2.1 | 搜索面板和输入框 | P0 | 6 |
| UI-1.2.2 | 筛选条件组件 | P1 | 8 |
| UI-1.2.3 | 高级搜索面板 | P1 | 6 |
| UI-1.2.4 | 排序指示器 | P1 | 4 |
| UI-1.2.5 | 搜索结果展示 | P0 | 6 |

---

## 3. 测试策略

### 3.1 测试方法

**黑盒测试 + 灰盒测试：**
- 通过前端界面执行搜索场景测试
- 验证 API 请求参数和响应数据
- 检查数据库查询性能（explain 分析）
- 验证搜索结果的准确性和完整性

### 3.2 测试重点

1. **搜索准确性**
   - 模糊匹配算法验证
   - 多条件组合查询准确性
   - 边界条件处理

2. **搜索性能**
   - 大数据量下的搜索响应时间
   - 数据库索引效果验证
   - 前端防抖（debounce）机制

3. **用户体验**
   - 搜索输入实时响应
   - 筛选条件清除便捷性
   - 排序操作直观性

### 3.3 测试工具

| 工具名称 | 用途 | 版本 |
|---------|------|------|
| Vitest + @vue/test-utils | 前端集成测试 | ^1.6.0 + ^2.4.0 |
| Playwright | E2E 搜索场景测试 | ^1.40.0 |
| MySQL EXPLAIN | 查询性能分析 | 8.0+ |
| Apache Benchmark (ab) | API 性能测试（可选） | 2.3+ |

---

## 4. 测试环境

### 4.1 数据量要求

**测试数据库规模：**
- 最少数据：1,000 条客户记录
- 推荐数据：10,000 条客户记录（性能测试）
- 数据分布：不同省份、类型、等级的客户均匀分布

### 4.2 环境配置

```
测试环境架构：
前端 (Vue 3 + Arco) → 后端 (Python Sanic) → MySQL 8.0+ (10k records)
```

### 4.3 性能基准

| 操作 | 数据量 | 响应时间要求 |
|------|--------|-------------|
| 简单关键词搜索 | 10k | <200ms |
| 多条件组合搜索 | 10k | <500ms |
| 高级搜索（时间范围） | 10k | <800ms |
| 搜索结果排序 | 10k | <300ms |

---

## 5. 测试数据准备

### 5.1 测试数据生成脚本

```sql
-- 生成 10,000 条测试数据
-- 省份分布：Shanghai, Beijing, Guangdong, Jiangsu, Zhejiang (各 20%)
-- 客户类型：enterprise (60%), individual (40%)
-- 客户等级：vip (10%), standard (70%), potential (20%)
-- 状态：active (80%), inactive (15%), potential (5%)
```

### 5.2 典型测试数据样本

| 公司名称 | 联系人 | 联系电话 | 省份 | 类型 | 等级 | 状态 |
|---------|--------|---------|------|------|------|------|
| 上海科技有限公司 | 张三 | 13800138000 | Shanghai | enterprise | vip | active |
| 北京贸易公司 | 李四 | 13900139000 | Beijing | enterprise | standard | active |
| 广州制造厂 | 王五 | 13700137000 | Guangdong | individual | standard | inactive |
| 张三咨询公司 | 张三 | 13600136000 | Jiangsu | individual | potential | potential |

### 5.3 特殊测试数据

**用于模糊匹配测试：**
- 包含特殊字符的公司名称
- 中文 + 英文混合名称
- 相似名称（测试精确匹配）

**用于边界测试：**
- 超长公司名称（150+ 字符）
- 极短关键词（1 个字符）
- 不存在的关键字

---

## 6. 测试用例清单

### 6.1 功能特性测试用例

#### F-1.2.1 关键词搜索功能

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.2.1-01 | 单关键词搜索 - 公司名称 | P0 | 输入公司关键字，验证匹配结果 |
| TC-F1.2.1-02 | 单关键词搜索 - 联系人 | P0 | 输入联系人姓名，验证匹配结果 |
| TC-F1.2.1-03 | 单关键词搜索 - 信用代码 | P0 | 输入信用代码关键字 |
| TC-F1.2.1-04 | 多关键词组合搜索 | P1 | 同时搜索公司名称和联系人 |
| TC-F1.2.1-05 | 模糊匹配 - 前缀匹配 | P0 | 输入"上海"，匹配"上海科技有限公司" |
| TC-F1.2.1-06 | 模糊匹配 - 包含匹配 | P0 | 输入"科技"，匹配"上海科技有限公司" |
| TC-F1.2.1-07 | 模糊匹配 - 后缀匹配 | P0 | 输入"公司"，匹配所有公司 |
| TC-F1.2.1-08 | 精确匹配模式 | P1 | 使用引号或精确匹配选项 |
| TC-F1.2.1-09 | 搜索无结果 | P1 | 输入不存在的关键字 |
| TC-F1.2.1-10 | 搜索关键词清空 | P1 | 清空搜索框，恢复完整列表 |

#### F-1.2.2 多条件筛选功能

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.2.2-01 | 单条件筛选 - 客户类型 | P0 | 仅筛选 enterprise |
| TC-F1.2.2-02 | 单条件筛选 - 省份 | P0 | 仅筛选 Shanghai |
| TC-F1.2.2-03 | 单条件筛选 - 客户等级 | P0 | 仅筛选 vip |
| TC-F1.2.2-04 | 双条件组合筛选 | P0 | 省份 + 类型组合 |
| TC-F1.2.2-05 | 三条件组合筛选 | P0 | 省份 + 类型 + 等级组合 |
| TC-F1.2.2-06 | 四条件组合筛选 | P1 | 省份 + 类型 + 等级 + 状态 |
| TC-F1.2.2-07 | 筛选条件清除 - 单个 | P1 | 清除单个筛选条件 |
| TC-F1.2.2-08 | 筛选条件清除 - 全部 | P1 | 一键清除所有筛选 |
| TC-F1.2.2-09 | 筛选结果为空 | P1 | 无匹配的组合条件 |
| TC-F1.2.2-10 | 筛选条件计数显示 | P2 | 显示每个条件的匹配数量 |
| TC-F1.2.2-11 | 筛选条件联动 | P2 | 选择省份后城市选项更新 |
| TC-F1.2.2-12 | 筛选历史记忆 | P2 | 刷新后保留筛选条件 |

#### F-1.2.3 高级搜索功能

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.2.3-01 | 创建时间范围搜索 - 开始时间 | P1 | 设置 created_from |
| TC-F1.2.3-02 | 创建时间范围搜索 - 结束时间 | P1 | 设置 created_to |
| TC-F1.2.3-03 | 创建时间范围搜索 - 完整范围 | P1 | 设置完整时间范围 |
| TC-F1.2.3-04 | 状态 + 来源组合搜索 | P1 | 多条件高级搜索 |
| TC-F1.2.3-05 | 保存搜索条件 | P2 | 保存常用搜索组合 |
| TC-F1.2.3-06 | 加载保存的搜索 | P2 | 应用保存的搜索条件 |
| TC-F1.2.3-07 | 删除保存的搜索 | P2 | 管理保存的搜索 |
| TC-F1.2.3-08 | 高级搜索面板展开收起 | P1 | UI 交互测试 |

#### F-1.2.4 搜索结果排序

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.2.4-01 | 单字段升序排序 | P1 | 点击公司名称升序 |
| TC-F1.2.4-02 | 单字段降序排序 | P1 | 点击公司名称降序 |
| TC-F1.2.4-03 | 切换排序方向 | P1 | 升序→降序切换 |
| TC-F1.2.4-04 | 多字段组合排序 | P1 | 省份 + 创建时间排序 |
| TC-F1.2.4-05 | 排序指示器显示 | P1 | 列头显示排序箭头 |
| TC-F1.2.4-06 | 清除排序 | P2 | 恢复默认排序 |

#### F-1.2.5 搜索条件保存

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-F1.2.5-01 | 保存搜索条件 - 命名 | P2 | 为搜索条件命名并保存 |
| TC-F1.2.5-02 | 加载保存的搜索条件 | P2 | 从列表选择并应用 |
| TC-F1.2.5-03 | 更新保存的搜索条件 | P2 | 修改后重新保存 |
| TC-F1.2.5-04 | 删除保存的搜索条件 | P2 | 删除不需要的搜索 |

### 6.2 集成接口测试用例

#### I-1.2.1 GET /api/v1/customers - 搜索参数验证

| 用例 ID | 用例名称 | 优先级 | 测试参数 |
|--------|---------|--------|---------|
| TC-I1.2.1-01 | search 参数 - 单字段匹配 | P0 | search=上海 |
| TC-I1.2.1-02 | search 参数 - 多字段匹配 | P0 | search=张三 |
| TC-I1.2.1-03 | search_fields 参数 | P1 | search_fields=company_name |
| TC-I1.2.1-04 | customer_type 筛选 | P0 | customer_type=enterprise |
| TC-I1.2.1-05 | province 筛选 | P0 | province=Shanghai |
| TC-I1.2.1-06 | level 筛选 | P0 | level=vip |
| TC-I1.2.1-07 | status 筛选 | P0 | status=active |
| TC-I1.2.1-08 | 多参数组合 | P0 | type+province+level 组合 |
| TC-I1.2.1-09 | created_from 参数 | P1 | created_from=2026-01-01 |
| TC-I1.2.1-10 | created_to 参数 | P1 | created_to=2026-02-25 |
| TC-I1.2.1-11 | sort 参数 - 单字段 | P1 | sort=company_name:asc |
| TC-I1.2.1-12 | sort 参数 - 多字段 | P1 | sort=province:asc,created_at:desc |

#### I-1.2.2 数据库索引优化验证

| 用例 ID | 用例名称 | 优先级 | 测试方法 |
|--------|---------|--------|---------|
| TC-I1.2.2-01 | EXPLAIN 分析 - 简单搜索 | P1 | 分析 search 查询计划 |
| TC-I1.2.2-02 | EXPLAIN 分析 - 多条件筛选 | P1 | 分析组合查询计划 |
| TC-I1.2.2-03 | EXPLAIN 分析 - 时间范围 | P1 | 分析时间范围查询计划 |
| TC-I1.2.2-04 | 索引命中率验证 | P1 | 验证使用 idx_customer_search |

### 6.3 用户界面集成测试用例

#### UI-1.2.1 搜索面板和输入框

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.2.1-01 | 搜索输入框显示 | P0 | 默认显示搜索框 |
| TC-1.2.1-02 | 搜索按钮功能 | P0 | 点击按钮触发搜索 |
| TC-UI1.2.1-03 | 回车键触发搜索 | P1 | 按 Enter 键触发搜索 |
| TC-UI1.2.1-04 | 搜索防抖机制 | P1 | 快速输入时延迟搜索 |
| TC-UI1.2.1-05 | 搜索框占位符提示 | P1 | 显示"搜索公司名称..." |
| TC-UI1.2.1-06 | 搜索框清空按钮 | P1 | 点击 X 清空搜索 |

#### UI-1.2.2 筛选条件组件

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.2.2-01 | 客户类型下拉选择 | P1 | 展开选项列表 |
| TC-UI1.2.2-02 | 省份下拉选择 | P1 | 展开省份列表 |
| TC-UI1.2.2-03 | 客户等级下拉选择 | P1 | 展开等级列表 |
| TC-UI1.2.2-04 | 状态下拉选择 | P1 | 展开状态列表 |
| TC-UI1.2.2-05 | 多选功能（如支持） | P2 | 选择多个类型 |
| TC-UI1.2.2-06 | 筛选条件重置 | P1 | 点击重置按钮 |
| TC-UI1.2.2-07 | 筛选芯片显示 | P1 | 已选条件显示为标签 |
| TC-UI1.2.2-08 | 筛选芯片删除 | P1 | 点击 X 删除单个条件 |

#### UI-1.2.3 高级搜索面板

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.2.3-01 | 高级搜索面板展开 | P1 | 点击展开高级选项 |
| TC-UI1.2.3-02 | 高级搜索面板收起 | P1 | 点击收起面板 |
| TC-UI1.2.3-03 | 日期范围选择器 | P1 | 选择开始和结束日期 |
| TC-UI1.2.3-04 | 来源下拉选择 | P1 | 选择客户来源 |
| TC-UI1.2.3-05 | 保存搜索按钮 | P2 | 显示保存功能 |
| TC-UI1.2.3-06 | 高级搜索应用按钮 | P1 | 点击应用搜索 |

#### UI-1.2.4 排序指示器

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.2.4-01 | 列头可点击 | P1 | 点击列头触发排序 |
| TC-UI1.2.4-02 | 升序箭头显示 | P1 | 升序时显示↑ |
| TC-UI1.2.4-03 | 降序箭头显示 | P1 | 降序时显示↓ |
| TC-UI1.2.4-04 | 多列排序指示 | P2 | 显示多字段排序 |

#### UI-1.2.5 搜索结果展示

| 用例 ID | 用例名称 | 优先级 | 测试场景 |
|--------|---------|--------|---------|
| TC-UI1.2.5-01 | 搜索结果计数显示 | P0 | 显示"找到 X 条结果" |
| TC-UI1.2.5-02 | 搜索结果高亮 | P1 | 关键词高亮显示 |
| TC-UI1.2.5-03 | 空结果提示 | P1 | 显示"未找到匹配结果" |
| TC-UI1.2.5-04 | 分页自动更新 | P0 | 搜索结果重新分页 |
| TC-UI1.2.5-05 | 搜索加载状态 | P1 | 显示 loading 动画 |
| TC-UI1.2.5-06 | 搜索结果导出（如支持） | P2 | 导出搜索结果 |

---

## 7. 测试执行计划

### 7.1 测试阶段

**阶段 1: API 层搜索功能测试**
- 执行所有搜索 API 测试用例
- 验证查询参数和响应数据
- 预计时间：4 小时

**阶段 2: 前端搜索 UI 测试**
- 执行搜索界面集成测试
- 验证用户交互和响应
- 预计时间：6 小时

**阶段 3: 数据库性能验证**
- 执行 EXPLAIN 分析
- 验证索引效果
- 预计时间：2 小时

**阶段 4: 端到端搜索场景测试**
- 执行完整搜索流程测试
- 验证搜索准确性和性能
- 预计时间：4 小时

### 7.2 测试顺序

```
1. 准备 10k 测试数据
   ↓
2. 执行 API 搜索测试 (I-1.2.1)
   ↓
3. 执行功能特性测试 (F-1.2.1 ~ F-1.2.5)
   ↓
4. 执行 UI 集成测试 (UI-1.2.x)
   ↓
5. 执行数据库性能验证 (I-1.2.2)
   ↓
6. 清理测试数据
   ↓
7. 生成测试报告
```

### 7.3 测试周期

| 活动 | 开始日期 | 结束日期 | 工作日 |
|------|---------|---------|-------|
| 测试数据准备 | 2026-02-26 | 2026-02-26 | 1 |
| 测试用例执行 | 2026-02-27 | 2026-03-02 | 4 |
| 缺陷修复和回归 | 2026-03-03 | 2026-03-05 | 3 |
| 测试报告编写 | 2026-03-06 | 2026-03-06 | 1 |

---

## 8. 风险评估与缓解

### 8.1 技术风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 搜索性能不达标 | 中 | 高 | 提前进行 EXPLAIN 分析，优化索引 |
| 模糊匹配算法不准确 | 中 | 高 | 准备多组测试数据验证匹配精度 |
| 大数据量测试环境不足 | 低 | 中 | 提前生成 10k 测试数据 |

### 8.2 进度风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 搜索功能开发延迟 | 中 | 中 | 与开发保持沟通，及时调整测试计划 |
| 性能优化耗时 | 高 | 中 | 预留足够的性能调优时间 |

---

## 9. 准入和准出标准

### 9.1 测试准入标准

- [ ] Story 1.2 所有功能开发完成
- [ ] 10k 测试数据准备完成
- [ ] 数据库索引创建完成
- [ ] 测试环境准备就绪

### 9.2 测试准出标准

- [ ] 所有 P0 测试用例 100% 通过
- [ ] P1 测试用例 95% 以上通过
- [ ] 搜索性能达标（<500ms for 10k）
- [ ] P0/P1 缺陷全部修复

---

## 10. 附录

### 10.1 性能测试脚本

```bash
# 使用 ab 进行简单性能测试
ab -n 1000 -c 10 "http://localhost:8000/api/v1/customers?search=科技"
```

### 10.2 参考文档

1. `_bmad-output/implementation-artifacts/stories/1-2-客户信息查询与搜索.md`
2. Story 1.1 测试计划

---

**文档结束**
